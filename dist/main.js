(()=>{"use strict";const e=function(e,t){let n=0,i=!1;return{hit:function(){return n+=1,n},getHits:function(){return n},isSunk:function(){return n==e&&(i=!0),i},length:e,shipName:t}},t=function(){let t=function(){let e=[],t=[],n=[],i=[],r=[];function o(e,t){return 10*e+t}function a(e,t,n,r){let a=o(e,t);if("Horizontal"==r)for(let e=0;e<n.length;e++)if(i.includes(a+e))return!1;if("Vertical"==r)for(let e=0;e<n.length;e++)if(i.includes(a+10*e))return!1;return!("Horizontal"==r&&t+n.length>10||"Vertical"==r&&e+n.length>10)}return{createBoard:function(){for(let t=0;t<10;t++)for(let n=0;n<10;n++){let i={coordinates:void 0,name:void 0};i.coordinates=[t,n],i.name=null,e.push(i)}return e},getBoard:function(){return e},checkValidity:a,placeShip:function(t,n,s,l){if("Horizontal"==l&&a(t,n,s,l)){let r=o(t,n);for(let t=0;t<s.length;t++)e[r+t].name=s.shipName,i.push(r+t)}if("Vertical"==l&&a(t,n,s,l)){let r=o(t,n);for(let t=0;t<s.length;t++)e[r+10*t].name=s.shipName,i.push(r+10*t)}r.push(s)},receiveAttack:function(i,a){let s=o(i,a);null!=e[s].name?n.includes(s)||(n.push(s),function(e){for(let t=0;t<r.length;t++)if(r[t].shipName==e)return r[t]}(e[s].name).hit()):t.includes(s)||t.push(s)},isAllSunk:function(){if(i.length==n.length)return!0},getMissedPositions:function(){return t},getAttackedPositions:function(){return n},getShipsPositions:function(){return i}}}(),n=[e(5,"Carrier"),e(4,"Battleship"),e(3,"Cruiser"),e(3,"Submarine"),e(2,"Destroyer")];function i(){return[Math.floor(10*Math.random()),Math.floor(10*Math.random())]}return{randomAttack:async function e(t){let n=i(),r=n[0],o=n[1],a=function(e,t){return 10*e+t}(r,o);t.getShotCoordinates().includes(a)?e(t):t.receiveAttack(r,o)},randomPlacement:function e(n){let r=i(),o=r[0],a=r[1],s="";s=1==Math.floor(2*Math.random())?"Horizontal":"Vertical",t.checkValidity(o,a,n,s)?t.placeShip(o,a,n,s):e(n)},getBoard:function(){return t},getShips:function(){return n},getShotCoordinates:function(){return[...t.getAttackedPositions(),...t.getMissedPositions()]},createBoard:t.createBoard,getBoard:t.getBoard,placeShip:t.placeShip,checkValidity:t.checkValidity,receiveAttack:t.receiveAttack,isAllSunk:t.isAllSunk,getMissedPositions:t.getMissedPositions,getAttackedPositions:t.getAttackedPositions,getShipsPositions:t.getShipsPositions}},n=function(){let e=t(),n=t();e.createBoard(),n.createBoard();let i=e.getBoard(),r=n.getBoard(),o=e.getShips(),a=n.getShips(),s="Gamer",l="",c=[];return{gamer:e,computer:n,setInput:function(e){c=e},gameLoop:function(){"Gamer"==s&&(n.receiveAttack(c[0],c[1]),n.isAllSunk()?l="Gamer":(s="Computer",c=[])),"Computer"==s&&(n.randomAttack(e),e.isAllSunk()?l="Computer":s="Gamer"),console.log(l)},getTurn:function(){return s},getWinner:function(){return l},getGamerBoard:function(){return i},getComputerBoard:function(){return r},getGamerShips:function(){return o},getComputerShips:function(){return a}}}();(function(){const e=document.querySelector(".display"),t=document.querySelector(".player-board"),i=document.querySelector(".computer-board"),r=document.querySelector(".direction"),o=document.querySelector(".reset");let a=n.getGamerBoard(),s=n.getComputerBoard(),l=[...n.getGamerShips()],c=[...n.getComputerShips()];function d(e){let t=e.classList[1].split(",");return[parseInt(t[0]),parseInt(t[1])]}return window.addEventListener("load",(()=>{e.textContent="Welcome to Battleship. Place your Carrier"})),window.addEventListener("click",(()=>{switch(l.length){case 4:e.textContent="Place your Battleship";break;case 3:e.textContent="Place your Cruiser";break;case 2:e.textContent="Place your Submarine";break;case 1:e.textContent="Place your Destroyer";break;case 0:""==n.getWinner()?e.textContent=`${n.getTurn()}'s Turn`:e.textContent=`${n.getWinner()} Won`}})),function(){let e,i,o=l[0];t.addEventListener("click",(s=>{if(s.target.classList.contains("player-board")){let c=s.target;if(e=d(c)[0],i=d(c)[1],l.length>0&&n.gamer.checkValidity(e,i,o,r.value)){n.gamer.placeShip(e,i,o,r.value),l.shift(),o=l[0];let s=n.gamer.getShipsPositions();for(let e=0;e<s.length;e++)t.children[s[e]].classList.add("player-ship");console.log(a)}}})),t.addEventListener("mouseover",(t=>{if(t.target.classList.contains("grid")){let a=t.target;e=d(a)[0],i=d(a)[1],l.length>0&&n.gamer.checkValidity(e,i,o,r.value)?a.classList.add("green"):l.length>0&&a.classList.add("red")}})),t.addEventListener("mouseout",(e=>{if(e.target.classList.contains("grid")){(t=e.target).classList.remove("green"),t.classList.remove("red")}var t}))}(),r.addEventListener("click",(()=>{"Horizontal"==r.value?(r.value="Vertical",r.textContent="Set Horizontal"):(r.value="Horizontal",r.textContent="Set Vertical")})),function(){let e=c[0];window.addEventListener("click",(()=>{for(;c.length>0;)n.computer.randomPlacement(e),c.shift(),e=c[0];let t=n.computer.getShipsPositions();for(let e=0;e<t.length;e++)i.children[t[e]].classList.add("computer-ship")}))}(),i.addEventListener("click",(e=>{if(0==l.length&&e.target.classList.contains("computer-board")){let t=e.target,i=parseInt(t.classList[0]),r=d(t)[0],o=d(t)[1];n.computer.getShotCoordinates().includes(i)||""!=n.getWinner()||0!=l.length||(n.setInput([r,o]),n.gameLoop())}})),window.addEventListener("click",(()=>{let e=n.gamer.getMissedPositions(),r=n.computer.getMissedPositions(),o=n.gamer.getAttackedPositions(),a=n.computer.getAttackedPositions();for(let n=0;n<e.length;n++)t.children[e[n]].classList.add("missed");for(let e=0;e<r.length;e++)i.children[r[e]].classList.add("missed");for(let e=0;e<o.length;e++)if(t.children[o[e]].classList.add("attacked"),0==t.children[o[e]].children.length){let n=document.createElement("div");n.classList.add("ship-svg"),t.children[o[e]].appendChild(n),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>ship-wheel</title><path d="M2,11L4.05,11.1C4.3,8.83 5.5,6.85 7.25,5.56L6.13,3.84C5.86,3.36 6,2.75 6.5,2.47C7,2.2 7.59,2.36 7.87,2.84L8.8,4.66C9.78,4.24 10.86,4 12,4C13.14,4 14.22,4.24 15.2,4.66L16.13,2.84C16.41,2.36 17,2.2 17.5,2.47C18,2.75 18.14,3.36 17.87,3.84L16.75,5.56C18.5,6.85 19.7,8.83 19.95,11.1L22,11A1,1 0 0,1 23,12A1,1 0 0,1 22,13L19.95,12.9C19.7,15.17 18.5,17.15 16.75,18.44L17.87,20.16C18.14,20.64 18,21.25 17.5,21.53C17,21.8 16.41,21.64 16.13,21.16L15.2,19.34C14.22,19.76 13.14,20 12,20C10.86,20 9.78,19.76 8.8,19.34L7.87,21.16C7.59,21.64 7,21.8 6.5,21.53C6,21.25 5.86,20.64 6.13,20.16L7.25,18.44C5.5,17.15 4.3,15.17 4.05,12.9L2,13A1,1 0 0,1 1,12A1,1 0 0,1 2,11M9.07,11.35C9.2,10.74 9.53,10.2 10,9.79L8.34,7.25C7.11,8.19 6.27,9.6 6.05,11.2L9.07,11.35M12,9C12.32,9 12.62,9.05 12.9,9.14L14.28,6.45C13.58,6.16 12.81,6 12,6C11.19,6 10.42,6.16 9.72,6.45L11.1,9.14C11.38,9.05 11.68,9 12,9M14.93,11.35L17.95,11.2C17.73,9.6 16.89,8.19 15.66,7.25L14,9.79C14.47,10.2 14.8,10.74 14.93,11.35M14.93,12.65C14.8,13.26 14.47,13.8 14,14.21L15.66,16.75C16.89,15.81 17.73,14.4 17.95,12.8L14.93,12.65M12,15C11.68,15 11.38,14.95 11.09,14.86L9.72,17.55C10.42,17.84 11.19,18 12,18C12.81,18 13.58,17.84 14.28,17.55L12.91,14.86C12.62,14.95 12.32,15 12,15M9.07,12.65L6.05,12.8C6.27,14.4 7.11,15.81 8.34,16.75L10,14.21C9.53,13.8 9.2,13.26 9.07,12.65Z" /></svg>'}for(let e=0;e<a.length;e++)if(i.children[a[e]].classList.add("attacked"),0==i.children[a[e]].children.length){let t=document.createElement("div");t.classList.add("ship-svg"),i.children[a[e]].appendChild(t),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>ship-wheel</title><path d="M2,11L4.05,11.1C4.3,8.83 5.5,6.85 7.25,5.56L6.13,3.84C5.86,3.36 6,2.75 6.5,2.47C7,2.2 7.59,2.36 7.87,2.84L8.8,4.66C9.78,4.24 10.86,4 12,4C13.14,4 14.22,4.24 15.2,4.66L16.13,2.84C16.41,2.36 17,2.2 17.5,2.47C18,2.75 18.14,3.36 17.87,3.84L16.75,5.56C18.5,6.85 19.7,8.83 19.95,11.1L22,11A1,1 0 0,1 23,12A1,1 0 0,1 22,13L19.95,12.9C19.7,15.17 18.5,17.15 16.75,18.44L17.87,20.16C18.14,20.64 18,21.25 17.5,21.53C17,21.8 16.41,21.64 16.13,21.16L15.2,19.34C14.22,19.76 13.14,20 12,20C10.86,20 9.78,19.76 8.8,19.34L7.87,21.16C7.59,21.64 7,21.8 6.5,21.53C6,21.25 5.86,20.64 6.13,20.16L7.25,18.44C5.5,17.15 4.3,15.17 4.05,12.9L2,13A1,1 0 0,1 1,12A1,1 0 0,1 2,11M9.07,11.35C9.2,10.74 9.53,10.2 10,9.79L8.34,7.25C7.11,8.19 6.27,9.6 6.05,11.2L9.07,11.35M12,9C12.32,9 12.62,9.05 12.9,9.14L14.28,6.45C13.58,6.16 12.81,6 12,6C11.19,6 10.42,6.16 9.72,6.45L11.1,9.14C11.38,9.05 11.68,9 12,9M14.93,11.35L17.95,11.2C17.73,9.6 16.89,8.19 15.66,7.25L14,9.79C14.47,10.2 14.8,10.74 14.93,11.35M14.93,12.65C14.8,13.26 14.47,13.8 14,14.21L15.66,16.75C16.89,15.81 17.73,14.4 17.95,12.8L14.93,12.65M12,15C11.68,15 11.38,14.95 11.09,14.86L9.72,17.55C10.42,17.84 11.19,18 12,18C12.81,18 13.58,17.84 14.28,17.55L12.91,14.86C12.62,14.95 12.32,15 12,15M9.07,12.65L6.05,12.8C6.27,14.4 7.11,15.81 8.34,16.75L10,14.21C9.53,13.8 9.2,13.26 9.07,12.65Z" /></svg>'}})),o.addEventListener("click",(()=>{location.reload()})),{createGameBoards:function(){for(let e=0;e<a.length;e++){let n=document.createElement("div");n.classList.add(e),n.classList.add(a[e].coordinates),n.classList.add("grid"),n.classList.add("player-board"),t.appendChild(n)}for(let e=0;e<s.length;e++){let t=document.createElement("div");t.classList.add(e),t.classList.add(s[e].coordinates),t.classList.add("grid"),t.classList.add("computer-board"),i.appendChild(t)}},wait:function(e){return new Promise((t=>setTimeout(t,e)))}}})().createGameBoards()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFLLElBQUk3RCxFQUFJLEVBQUdBLEVBQUk2QixFQUFjakQsT0FBUW9CLElBQUssQ0FDN0MsSUFBSTZELEVBQU9mLFNBQVM2QixjQUFjLE9BQ2xDZCxFQUFLUCxVQUFVYSxJQUFJbkUsR0FDbkI2RCxFQUFLUCxVQUFVYSxJQUFJdEMsRUFBYzdCLEdBQUdLLGFBQ3BDd0QsRUFBS1AsVUFBVWEsSUFBSSxRQUNuQk4sRUFBS1AsVUFBVWEsSUFBSSxrQkFDbkJsQixFQUFpQjJCLFlBQVlmLEVBQy9CLENBQ0YsRUF5TkVvQixLQVpGLFNBQWNDLEdBQ1osT0FBTyxJQUFJQyxTQUFTQyxHQUFZQyxXQUFXRCxFQUFTRixJQUN0RCxFQVlELEVBeFBXLEdDQ1JGLGtCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9zaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvcGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZWJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2RvbS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHNoaXAgPSBmdW5jdGlvbiAobGVuZ3RoLCBuYW1lKSB7XG4gIGxldCBoaXRzID0gMDtcbiAgbGV0IHN1bmsgPSBmYWxzZTtcbiAgbGV0IHNoaXBOYW1lID0gbmFtZTtcblxuICBmdW5jdGlvbiBoaXQoKSB7XG4gICAgaGl0cyArPSAxO1xuICAgIHJldHVybiBoaXRzO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNTdW5rKCkge1xuICAgIGlmIChoaXRzID09IGxlbmd0aCkge1xuICAgICAgc3VuayA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiBzdW5rO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0SGl0cygpIHtcbiAgICByZXR1cm4gaGl0cztcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgaGl0LFxuICAgIGdldEhpdHMsXG4gICAgaXNTdW5rLFxuICAgIGxlbmd0aCxcbiAgICBzaGlwTmFtZSxcbiAgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHNoaXA7XG4iLCJpbXBvcnQgc2hpcCBmcm9tIFwiLi9zaGlwXCI7XG5pbXBvcnQgZ2FtZUJvYXJkIGZyb20gXCIuL2dhbWVib2FyZFwiO1xuXG5jb25zdCBwbGF5ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGxldCBib2FyZCA9IGdhbWVCb2FyZCgpO1xuICBsZXQgY2FycmllciA9IHNoaXAoNSwgXCJDYXJyaWVyXCIpO1xuICBsZXQgYmF0dGxlc2hpcCA9IHNoaXAoNCwgXCJCYXR0bGVzaGlwXCIpO1xuICBsZXQgY3J1aXNlciA9IHNoaXAoMywgXCJDcnVpc2VyXCIpO1xuICBsZXQgc3VibWFyaW5lID0gc2hpcCgzLCBcIlN1Ym1hcmluZVwiKTtcbiAgbGV0IGRlc3Ryb3llciA9IHNoaXAoMiwgXCJEZXN0cm95ZXJcIik7XG4gIGxldCBzaGlwcyA9IFtjYXJyaWVyLCBiYXR0bGVzaGlwLCBjcnVpc2VyLCBzdWJtYXJpbmUsIGRlc3Ryb3llcl07XG5cbiAgZnVuY3Rpb24gaW5kZXhGaW5kZXIocG9zMSwgcG9zMikge1xuICAgIGxldCBpbmRleCA9IHBvczEgKiAxMCArIHBvczI7XG4gICAgcmV0dXJuIGluZGV4O1xuICB9XG5cbiAgZnVuY3Rpb24gd2FpdChtcykge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xuICB9XG5cbiAgZnVuY3Rpb24gcmFuZG9tQ29vcmRpbmF0ZXMoKSB7XG4gICAgbGV0IHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgbGV0IHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG5cbiAgICByZXR1cm4gW3gsIHldO1xuICB9XG5cbiAgYXN5bmMgZnVuY3Rpb24gcmFuZG9tQXR0YWNrKHBsYXllcikge1xuICAgIGxldCBjb29yZGluYXRlcyA9IHJhbmRvbUNvb3JkaW5hdGVzKCk7XG4gICAgbGV0IHBvczEgPSBjb29yZGluYXRlc1swXTtcbiAgICBsZXQgcG9zMiA9IGNvb3JkaW5hdGVzWzFdO1xuXG4gICAgbGV0IGluZGV4ID0gaW5kZXhGaW5kZXIocG9zMSwgcG9zMik7XG5cbiAgICBpZiAocGxheWVyLmdldFNob3RDb29yZGluYXRlcygpLmluY2x1ZGVzKGluZGV4KSkge1xuICAgICAgcmFuZG9tQXR0YWNrKHBsYXllcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBsYXllci5yZWNlaXZlQXR0YWNrKHBvczEsIHBvczIpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHJhbmRvbVBsYWNlbWVudChzaGlwKSB7XG4gICAgbGV0IGNvb3JkaW5hdGVzID0gcmFuZG9tQ29vcmRpbmF0ZXMoKTtcbiAgICBsZXQgcG9zMSA9IGNvb3JkaW5hdGVzWzBdO1xuICAgIGxldCBwb3MyID0gY29vcmRpbmF0ZXNbMV07XG4gICAgbGV0IGRpcmVjdGlvbiA9IFwiXCI7XG5cbiAgICBsZXQgcmFuZG9tRGlyZWN0aW9uID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMik7XG5cbiAgICBpZiAocmFuZG9tRGlyZWN0aW9uID09IDEpIHtcbiAgICAgIGRpcmVjdGlvbiA9IFwiSG9yaXpvbnRhbFwiO1xuICAgIH0gZWxzZSB7XG4gICAgICBkaXJlY3Rpb24gPSBcIlZlcnRpY2FsXCI7XG4gICAgfVxuXG4gICAgaWYgKGJvYXJkLmNoZWNrVmFsaWRpdHkocG9zMSwgcG9zMiwgc2hpcCwgZGlyZWN0aW9uKSkge1xuICAgICAgYm9hcmQucGxhY2VTaGlwKHBvczEsIHBvczIsIHNoaXAsIGRpcmVjdGlvbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJhbmRvbVBsYWNlbWVudChzaGlwKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBnZXRCb2FyZCgpIHtcbiAgICByZXR1cm4gYm9hcmQ7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRTaGlwcygpIHtcbiAgICByZXR1cm4gc2hpcHM7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRTaG90Q29vcmRpbmF0ZXMoKSB7XG4gICAgbGV0IGF0dGFja2VkID0gYm9hcmQuZ2V0QXR0YWNrZWRQb3NpdGlvbnMoKTtcbiAgICBsZXQgbWlzc2VkID0gYm9hcmQuZ2V0TWlzc2VkUG9zaXRpb25zKCk7XG4gICAgbGV0IHNob3RDb29yZGluYXRlcyA9IFsuLi5hdHRhY2tlZCwgLi4ubWlzc2VkXTtcbiAgICByZXR1cm4gc2hvdENvb3JkaW5hdGVzO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICByYW5kb21BdHRhY2ssXG4gICAgcmFuZG9tUGxhY2VtZW50LFxuICAgIGdldEJvYXJkLFxuICAgIGdldFNoaXBzLFxuICAgIGdldFNob3RDb29yZGluYXRlcyxcbiAgICBjcmVhdGVCb2FyZDogYm9hcmQuY3JlYXRlQm9hcmQsXG4gICAgZ2V0Qm9hcmQ6IGJvYXJkLmdldEJvYXJkLFxuICAgIHBsYWNlU2hpcDogYm9hcmQucGxhY2VTaGlwLFxuICAgIGNoZWNrVmFsaWRpdHk6IGJvYXJkLmNoZWNrVmFsaWRpdHksXG4gICAgcmVjZWl2ZUF0dGFjazogYm9hcmQucmVjZWl2ZUF0dGFjayxcbiAgICBpc0FsbFN1bms6IGJvYXJkLmlzQWxsU3VuayxcbiAgICBnZXRNaXNzZWRQb3NpdGlvbnM6IGJvYXJkLmdldE1pc3NlZFBvc2l0aW9ucyxcbiAgICBnZXRBdHRhY2tlZFBvc2l0aW9uczogYm9hcmQuZ2V0QXR0YWNrZWRQb3NpdGlvbnMsXG4gICAgZ2V0U2hpcHNQb3NpdGlvbnM6IGJvYXJkLmdldFNoaXBzUG9zaXRpb25zLFxuICB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgcGxheWVyO1xuIiwiaW1wb3J0IHNoaXAgZnJvbSBcIi4vc2hpcFwiO1xuY29uc3QgZ2FtZUJvYXJkID0gZnVuY3Rpb24gKCkge1xuICBsZXQgYm9hcmQgPSBbXTtcbiAgbGV0IG1pc3NlZEF0dGFjayA9IFtdO1xuICBsZXQgYXR0YWNrZWRQb3NpdGlvbiA9IFtdO1xuICBsZXQgc2hpcFBvc2l0aW9uID0gW107XG4gIGxldCBzaGlwcyA9IFtdO1xuXG4gIGZ1bmN0aW9uIGNyZWF0ZUNvb3JkaW5hdGUoY29vcmRpbmF0ZXMsIG5hbWUpIHtcbiAgICByZXR1cm4geyBjb29yZGluYXRlcywgbmFtZSB9O1xuICB9XG5cbiAgZnVuY3Rpb24gaW5kZXhGaW5kZXIocG9zMSwgcG9zMikge1xuICAgIGxldCBpbmRleCA9IHBvczEgKiAxMCArIHBvczI7XG4gICAgcmV0dXJuIGluZGV4O1xuICB9XG5cbiAgZnVuY3Rpb24gY3JlYXRlQm9hcmQoKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgbGV0IG5ld0Nvb3JkaW5hdGVzID0gY3JlYXRlQ29vcmRpbmF0ZSgpO1xuICAgICAgICBuZXdDb29yZGluYXRlcy5jb29yZGluYXRlcyA9IFtpLCBqXTtcbiAgICAgICAgbmV3Q29vcmRpbmF0ZXMubmFtZSA9IG51bGw7XG4gICAgICAgIGJvYXJkLnB1c2gobmV3Q29vcmRpbmF0ZXMpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH1cblxuICBmdW5jdGlvbiBjaGVja1ZhbGlkaXR5KHBvczEsIHBvczIsIHNoaXAsIGRpcmVjdGlvbikge1xuICAgIGxldCBpbmRleCA9IGluZGV4RmluZGVyKHBvczEsIHBvczIpO1xuXG4gICAgaWYgKGRpcmVjdGlvbiA9PSBcIkhvcml6b250YWxcIikge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChzaGlwUG9zaXRpb24uaW5jbHVkZXMoaW5kZXggKyBpKSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChkaXJlY3Rpb24gPT0gXCJWZXJ0aWNhbFwiKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKHNoaXBQb3NpdGlvbi5pbmNsdWRlcyhpbmRleCArIGkgKiAxMCkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZGlyZWN0aW9uID09IFwiSG9yaXpvbnRhbFwiICYmIHBvczIgKyBzaGlwLmxlbmd0aCA+IDEwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKGRpcmVjdGlvbiA9PSBcIlZlcnRpY2FsXCIgJiYgcG9zMSArIHNoaXAubGVuZ3RoID4gMTApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBmdW5jdGlvbiBwbGFjZVNoaXAocG9zMSwgcG9zMiwgc2hpcCwgZGlyZWN0aW9uKSB7XG4gICAgaWYgKFxuICAgICAgZGlyZWN0aW9uID09IFwiSG9yaXpvbnRhbFwiICYmXG4gICAgICBjaGVja1ZhbGlkaXR5KHBvczEsIHBvczIsIHNoaXAsIGRpcmVjdGlvbilcbiAgICApIHtcbiAgICAgIGxldCBpbmRleCA9IGluZGV4RmluZGVyKHBvczEsIHBvczIpO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYm9hcmRbaW5kZXggKyBpXS5uYW1lID0gc2hpcC5zaGlwTmFtZTtcbiAgICAgICAgc2hpcFBvc2l0aW9uLnB1c2goaW5kZXggKyBpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZGlyZWN0aW9uID09IFwiVmVydGljYWxcIiAmJiBjaGVja1ZhbGlkaXR5KHBvczEsIHBvczIsIHNoaXAsIGRpcmVjdGlvbikpIHtcbiAgICAgIGxldCBpbmRleCA9IGluZGV4RmluZGVyKHBvczEsIHBvczIpO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYm9hcmRbaW5kZXggKyBpICogMTBdLm5hbWUgPSBzaGlwLnNoaXBOYW1lO1xuICAgICAgICBzaGlwUG9zaXRpb24ucHVzaChpbmRleCArIGkgKiAxMCk7XG4gICAgICB9XG4gICAgfVxuICAgIHNoaXBzLnB1c2goc2hpcCk7XG4gIH1cblxuICBmdW5jdGlvbiByZWNlaXZlQXR0YWNrKHBvczEsIHBvczIpIHtcbiAgICBsZXQgaW5kZXggPSBpbmRleEZpbmRlcihwb3MxLCBwb3MyKTtcblxuICAgIGlmIChib2FyZFtpbmRleF0ubmFtZSAhPSBudWxsKSB7XG4gICAgICBpZiAoIWF0dGFja2VkUG9zaXRpb24uaW5jbHVkZXMoaW5kZXgpKSB7XG4gICAgICAgIGF0dGFja2VkUG9zaXRpb24ucHVzaChpbmRleCk7XG4gICAgICAgIGZpbmRTaGlwKGJvYXJkW2luZGV4XS5uYW1lKS5oaXQoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCFtaXNzZWRBdHRhY2suaW5jbHVkZXMoaW5kZXgpKSB7XG4gICAgICAgIG1pc3NlZEF0dGFjay5wdXNoKGluZGV4KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBmaW5kU2hpcChuYW1lKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKHNoaXBzW2ldLnNoaXBOYW1lID09IG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHNoaXBzW2ldO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGlzQWxsU3VuaygpIHtcbiAgICBpZiAoc2hpcFBvc2l0aW9uLmxlbmd0aCA9PSBhdHRhY2tlZFBvc2l0aW9uLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZ2V0Qm9hcmQoKSB7XG4gICAgcmV0dXJuIGJvYXJkO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0TWlzc2VkUG9zaXRpb25zKCkge1xuICAgIHJldHVybiBtaXNzZWRBdHRhY2s7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRTaGlwc1Bvc2l0aW9ucygpIHtcbiAgICByZXR1cm4gc2hpcFBvc2l0aW9uO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0QXR0YWNrZWRQb3NpdGlvbnMoKSB7XG4gICAgcmV0dXJuIGF0dGFja2VkUG9zaXRpb247XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBjcmVhdGVCb2FyZCxcbiAgICBnZXRCb2FyZCxcbiAgICBjaGVja1ZhbGlkaXR5LFxuICAgIHBsYWNlU2hpcCxcbiAgICByZWNlaXZlQXR0YWNrLFxuICAgIGlzQWxsU3VuayxcbiAgICBnZXRNaXNzZWRQb3NpdGlvbnMsXG4gICAgZ2V0QXR0YWNrZWRQb3NpdGlvbnMsXG4gICAgZ2V0U2hpcHNQb3NpdGlvbnMsXG4gIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBnYW1lQm9hcmQ7XG4iLCJpbXBvcnQgc2hpcCBmcm9tIFwiLi9zaGlwXCI7XG5pbXBvcnQgZ2FtZUJvYXJkIGZyb20gXCIuL2dhbWVib2FyZFwiO1xuaW1wb3J0IGRvbSBmcm9tIFwiLi9kb21cIjtcbmltcG9ydCBwbGF5ZXIgZnJvbSBcIi4vcGxheWVyXCI7XG5cbmNvbnN0IGdhbWUgPSAoZnVuY3Rpb24gKCkge1xuICBsZXQgZ2FtZXIgPSBwbGF5ZXIoKTtcbiAgbGV0IGNvbXB1dGVyID0gcGxheWVyKCk7XG5cbiAgZ2FtZXIuY3JlYXRlQm9hcmQoKTtcbiAgY29tcHV0ZXIuY3JlYXRlQm9hcmQoKTtcblxuICBsZXQgZ2FtZXJCb2FyZCA9IGdhbWVyLmdldEJvYXJkKCk7XG4gIGxldCBjb21wdXRlckJvYXJkID0gY29tcHV0ZXIuZ2V0Qm9hcmQoKTtcbiAgbGV0IGdhbWVyU2hpcHMgPSBnYW1lci5nZXRTaGlwcygpO1xuICBsZXQgY29tcHV0ZXJTaGlwcyA9IGNvbXB1dGVyLmdldFNoaXBzKCk7XG5cbiAgbGV0IHR1cm4gPSBcIkdhbWVyXCI7XG4gIGxldCB3aW5uZXIgPSBcIlwiO1xuICBsZXQgaW5wdXQgPSBbXTtcblxuICBmdW5jdGlvbiBnYW1lTG9vcCgpIHtcbiAgICBpZiAodHVybiA9PSBcIkdhbWVyXCIpIHtcbiAgICAgIGNvbXB1dGVyLnJlY2VpdmVBdHRhY2soaW5wdXRbMF0sIGlucHV0WzFdKTtcbiAgICAgIGlmIChjb21wdXRlci5pc0FsbFN1bmsoKSkge1xuICAgICAgICB3aW5uZXIgPSBcIkdhbWVyXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0dXJuID0gXCJDb21wdXRlclwiO1xuICAgICAgICBpbnB1dCA9IFtdO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodHVybiA9PSBcIkNvbXB1dGVyXCIpIHtcbiAgICAgIGNvbXB1dGVyLnJhbmRvbUF0dGFjayhnYW1lcik7XG4gICAgICBpZiAoZ2FtZXIuaXNBbGxTdW5rKCkpIHtcbiAgICAgICAgd2lubmVyID0gXCJDb21wdXRlclwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdHVybiA9IFwiR2FtZXJcIjtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc29sZS5sb2cod2lubmVyKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldElucHV0KGNvb3JkaW5hdGVzKSB7XG4gICAgaW5wdXQgPSBjb29yZGluYXRlcztcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFR1cm4oKSB7XG4gICAgcmV0dXJuIHR1cm47XG4gIH1cblxuICBmdW5jdGlvbiBnZXRXaW5uZXIoKSB7XG4gICAgcmV0dXJuIHdpbm5lcjtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEdhbWVyQm9hcmQoKSB7XG4gICAgcmV0dXJuIGdhbWVyQm9hcmQ7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRDb21wdXRlckJvYXJkKCkge1xuICAgIHJldHVybiBjb21wdXRlckJvYXJkO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0R2FtZXJTaGlwcygpIHtcbiAgICByZXR1cm4gZ2FtZXJTaGlwcztcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldENvbXB1dGVyU2hpcHMoKSB7XG4gICAgcmV0dXJuIGNvbXB1dGVyU2hpcHM7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGdhbWVyLFxuICAgIGNvbXB1dGVyLFxuICAgIHNldElucHV0LFxuICAgIGdhbWVMb29wLFxuICAgIGdldFR1cm4sXG4gICAgZ2V0V2lubmVyLFxuICAgIGdldEdhbWVyQm9hcmQsXG4gICAgZ2V0Q29tcHV0ZXJCb2FyZCxcbiAgICBnZXRHYW1lclNoaXBzLFxuICAgIGdldENvbXB1dGVyU2hpcHMsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBnYW1lO1xuIiwiaW1wb3J0IHNoaXAgZnJvbSBcIi4vc2hpcFwiO1xuaW1wb3J0IGdhbWVCb2FyZCBmcm9tIFwiLi9nYW1lYm9hcmRcIjtcbmltcG9ydCBwbGF5ZXIgZnJvbSBcIi4vcGxheWVyXCI7XG5pbXBvcnQgZ2FtZSBmcm9tIFwiLi9nYW1lXCI7XG5cbmNvbnN0IGRvbSA9IChmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IGRpc3BsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmRpc3BsYXlcIik7XG4gIGNvbnN0IHBsYXllckJvYXJkRGl2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItYm9hcmRcIik7XG4gIGNvbnN0IGNvbXB1dGVyQm9hcmREaXYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNvbXB1dGVyLWJvYXJkXCIpO1xuICBjb25zdCBkaXJlY3Rpb25CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmRpcmVjdGlvblwiKTtcbiAgY29uc3QgcmVzZXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJlc2V0XCIpO1xuXG4gIGxldCBnYW1lckJvYXJkID0gZ2FtZS5nZXRHYW1lckJvYXJkKCk7XG4gIGxldCBjb21wdXRlckJvYXJkID0gZ2FtZS5nZXRDb21wdXRlckJvYXJkKCk7XG4gIGxldCBnYW1lclNoaXBzID0gWy4uLmdhbWUuZ2V0R2FtZXJTaGlwcygpXTtcbiAgbGV0IGNvbXB1dGVyU2hpcHMgPSBbLi4uZ2FtZS5nZXRDb21wdXRlclNoaXBzKCldO1xuXG4gIGZ1bmN0aW9uIGNyZWF0ZUdhbWVCb2FyZHMoKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBnYW1lckJvYXJkLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgZ3JpZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBncmlkLmNsYXNzTGlzdC5hZGQoaSk7XG4gICAgICBncmlkLmNsYXNzTGlzdC5hZGQoZ2FtZXJCb2FyZFtpXS5jb29yZGluYXRlcyk7XG4gICAgICBncmlkLmNsYXNzTGlzdC5hZGQoXCJncmlkXCIpO1xuICAgICAgZ3JpZC5jbGFzc0xpc3QuYWRkKFwicGxheWVyLWJvYXJkXCIpO1xuICAgICAgcGxheWVyQm9hcmREaXYuYXBwZW5kQ2hpbGQoZ3JpZCk7XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29tcHV0ZXJCb2FyZC5sZW5ndGg7IGkrKykge1xuICAgICAgbGV0IGdyaWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgZ3JpZC5jbGFzc0xpc3QuYWRkKGkpO1xuICAgICAgZ3JpZC5jbGFzc0xpc3QuYWRkKGNvbXB1dGVyQm9hcmRbaV0uY29vcmRpbmF0ZXMpO1xuICAgICAgZ3JpZC5jbGFzc0xpc3QuYWRkKFwiZ3JpZFwiKTtcbiAgICAgIGdyaWQuY2xhc3NMaXN0LmFkZChcImNvbXB1dGVyLWJvYXJkXCIpO1xuICAgICAgY29tcHV0ZXJCb2FyZERpdi5hcHBlbmRDaGlsZChncmlkKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBnZXRDb29yZGluYXRlcyh0YXJnZXQpIHtcbiAgICBsZXQgY29vcmRpbmF0ZXMgPSB0YXJnZXQuY2xhc3NMaXN0WzFdLnNwbGl0KFwiLFwiKTtcbiAgICBsZXQgcG9zMSA9IHBhcnNlSW50KGNvb3JkaW5hdGVzWzBdKTtcbiAgICBsZXQgcG9zMiA9IHBhcnNlSW50KGNvb3JkaW5hdGVzWzFdKTtcblxuICAgIHJldHVybiBbcG9zMSwgcG9zMl07XG4gIH1cblxuICBmdW5jdGlvbiBhZGRWYWxpZGl0eUNvbG9yKGNlbGwpIHtcbiAgICBjZWxsLmNsYXNzTGlzdC5hZGQoXCJncmVlblwiKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZVZhbGlkaXR5Q29sb3IoY2VsbCkge1xuICAgIGNlbGwuY2xhc3NMaXN0LnJlbW92ZShcImdyZWVuXCIpO1xuICAgIGNlbGwuY2xhc3NMaXN0LnJlbW92ZShcInJlZFwiKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZE5vblZhbGlkaXR5Q29sb3IoY2VsbCkge1xuICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcInJlZFwiKTtcbiAgfVxuXG4gIChmdW5jdGlvbiBkaXNwbGF5RXZlbnRzKCkge1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCAoKSA9PiB7XG4gICAgICBkaXNwbGF5LnRleHRDb250ZW50ID0gXCJXZWxjb21lIHRvIEJhdHRsZXNoaXAuIFBsYWNlIHlvdXIgQ2FycmllclwiO1xuICAgIH0pO1xuXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBzd2l0Y2ggKGdhbWVyU2hpcHMubGVuZ3RoKSB7XG4gICAgICAgIGNhc2UgNDpcbiAgICAgICAgICBkaXNwbGF5LnRleHRDb250ZW50ID0gXCJQbGFjZSB5b3VyIEJhdHRsZXNoaXBcIjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAzOlxuICAgICAgICAgIGRpc3BsYXkudGV4dENvbnRlbnQgPSBcIlBsYWNlIHlvdXIgQ3J1aXNlclwiO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgZGlzcGxheS50ZXh0Q29udGVudCA9IFwiUGxhY2UgeW91ciBTdWJtYXJpbmVcIjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAxOlxuICAgICAgICAgIGRpc3BsYXkudGV4dENvbnRlbnQgPSBcIlBsYWNlIHlvdXIgRGVzdHJveWVyXCI7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAwOlxuICAgICAgICAgIGlmIChnYW1lLmdldFdpbm5lcigpID09IFwiXCIpIHtcbiAgICAgICAgICAgIGRpc3BsYXkudGV4dENvbnRlbnQgPSBgJHtnYW1lLmdldFR1cm4oKX0ncyBUdXJuYDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGlzcGxheS50ZXh0Q29udGVudCA9IGAke2dhbWUuZ2V0V2lubmVyKCl9IFdvbmA7XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9KSgpO1xuXG4gIChmdW5jdGlvbiBwbGF5ZXJCb2FyZEV2ZW50cygpIHtcbiAgICBsZXQgY3VycmVudFNoaXAgPSBnYW1lclNoaXBzWzBdO1xuICAgIGxldCBwb3MxO1xuICAgIGxldCBwb3MyO1xuXG4gICAgcGxheWVyQm9hcmREaXYuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChncmlkKSA9PiB7XG4gICAgICBpZiAoZ3JpZC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicGxheWVyLWJvYXJkXCIpKSB7XG4gICAgICAgIGxldCB0YXJnZXQgPSBncmlkLnRhcmdldDtcbiAgICAgICAgcG9zMSA9IGdldENvb3JkaW5hdGVzKHRhcmdldClbMF07XG4gICAgICAgIHBvczIgPSBnZXRDb29yZGluYXRlcyh0YXJnZXQpWzFdO1xuICAgICAgICBpZiAoXG4gICAgICAgICAgZ2FtZXJTaGlwcy5sZW5ndGggPiAwICYmXG4gICAgICAgICAgZ2FtZS5nYW1lci5jaGVja1ZhbGlkaXR5KFxuICAgICAgICAgICAgcG9zMSxcbiAgICAgICAgICAgIHBvczIsXG4gICAgICAgICAgICBjdXJyZW50U2hpcCxcbiAgICAgICAgICAgIGRpcmVjdGlvbkJ1dHRvbi52YWx1ZVxuICAgICAgICAgIClcbiAgICAgICAgKSB7XG4gICAgICAgICAgZ2FtZS5nYW1lci5wbGFjZVNoaXAocG9zMSwgcG9zMiwgY3VycmVudFNoaXAsIGRpcmVjdGlvbkJ1dHRvbi52YWx1ZSk7XG4gICAgICAgICAgZ2FtZXJTaGlwcy5zaGlmdCgpO1xuICAgICAgICAgIGN1cnJlbnRTaGlwID0gZ2FtZXJTaGlwc1swXTtcbiAgICAgICAgICBsZXQgc2hpcFBvc2l0aW9ucyA9IGdhbWUuZ2FtZXIuZ2V0U2hpcHNQb3NpdGlvbnMoKTtcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBQb3NpdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHBsYXllckJvYXJkRGl2LmNoaWxkcmVuW3NoaXBQb3NpdGlvbnNbaV1dLmNsYXNzTGlzdC5hZGQoXG4gICAgICAgICAgICAgIFwicGxheWVyLXNoaXBcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc29sZS5sb2coZ2FtZXJCb2FyZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHBsYXllckJvYXJkRGl2LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW92ZXJcIiwgKGdyaWQpID0+IHtcbiAgICAgIGlmIChncmlkLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJncmlkXCIpKSB7XG4gICAgICAgIGxldCB0YXJnZXQgPSBncmlkLnRhcmdldDtcbiAgICAgICAgcG9zMSA9IGdldENvb3JkaW5hdGVzKHRhcmdldClbMF07XG4gICAgICAgIHBvczIgPSBnZXRDb29yZGluYXRlcyh0YXJnZXQpWzFdO1xuICAgICAgICBpZiAoXG4gICAgICAgICAgZ2FtZXJTaGlwcy5sZW5ndGggPiAwICYmXG4gICAgICAgICAgZ2FtZS5nYW1lci5jaGVja1ZhbGlkaXR5KFxuICAgICAgICAgICAgcG9zMSxcbiAgICAgICAgICAgIHBvczIsXG4gICAgICAgICAgICBjdXJyZW50U2hpcCxcbiAgICAgICAgICAgIGRpcmVjdGlvbkJ1dHRvbi52YWx1ZVxuICAgICAgICAgIClcbiAgICAgICAgKSB7XG4gICAgICAgICAgYWRkVmFsaWRpdHlDb2xvcih0YXJnZXQpO1xuICAgICAgICB9IGVsc2UgaWYgKGdhbWVyU2hpcHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGFkZE5vblZhbGlkaXR5Q29sb3IodGFyZ2V0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcGxheWVyQm9hcmREaXYuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3V0XCIsIChncmlkKSA9PiB7XG4gICAgICBpZiAoZ3JpZC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiZ3JpZFwiKSkge1xuICAgICAgICBsZXQgdGFyZ2V0ID0gZ3JpZC50YXJnZXQ7XG4gICAgICAgIHJlbW92ZVZhbGlkaXR5Q29sb3IodGFyZ2V0KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSkoKTtcblxuICBkaXJlY3Rpb25CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBpZiAoZGlyZWN0aW9uQnV0dG9uLnZhbHVlID09IFwiSG9yaXpvbnRhbFwiKSB7XG4gICAgICBkaXJlY3Rpb25CdXR0b24udmFsdWUgPSBcIlZlcnRpY2FsXCI7XG4gICAgICBkaXJlY3Rpb25CdXR0b24udGV4dENvbnRlbnQgPSBcIlNldCBIb3Jpem9udGFsXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRpcmVjdGlvbkJ1dHRvbi52YWx1ZSA9IFwiSG9yaXpvbnRhbFwiO1xuICAgICAgZGlyZWN0aW9uQnV0dG9uLnRleHRDb250ZW50ID0gXCJTZXQgVmVydGljYWxcIjtcbiAgICB9XG4gIH0pO1xuXG4gIChmdW5jdGlvbiBjb21wdXRlckJvYXJkRXZlbnRzKCkge1xuICAgIGxldCBjdXJyZW50U2hpcCA9IGNvbXB1dGVyU2hpcHNbMF07XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB3aGlsZSAoY29tcHV0ZXJTaGlwcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGdhbWUuY29tcHV0ZXIucmFuZG9tUGxhY2VtZW50KGN1cnJlbnRTaGlwKTtcbiAgICAgICAgY29tcHV0ZXJTaGlwcy5zaGlmdCgpO1xuICAgICAgICBjdXJyZW50U2hpcCA9IGNvbXB1dGVyU2hpcHNbMF07XG4gICAgICB9XG4gICAgICBsZXQgc2hpcFBvc2l0aW9ucyA9IGdhbWUuY29tcHV0ZXIuZ2V0U2hpcHNQb3NpdGlvbnMoKTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcFBvc2l0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb21wdXRlckJvYXJkRGl2LmNoaWxkcmVuW3NoaXBQb3NpdGlvbnNbaV1dLmNsYXNzTGlzdC5hZGQoXG4gICAgICAgICAgXCJjb21wdXRlci1zaGlwXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSkoKTtcblxuICAoZnVuY3Rpb24gZ2FtZUxvb3BFdmVudHMoKSB7XG4gICAgY29tcHV0ZXJCb2FyZERpdi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGdyaWQpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgZ2FtZXJTaGlwcy5sZW5ndGggPT0gMCAmJlxuICAgICAgICBncmlkLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJjb21wdXRlci1ib2FyZFwiKVxuICAgICAgKSB7XG4gICAgICAgIGxldCB0YXJnZXQgPSBncmlkLnRhcmdldDtcbiAgICAgICAgbGV0IGluZGV4ID0gcGFyc2VJbnQodGFyZ2V0LmNsYXNzTGlzdFswXSk7XG4gICAgICAgIGxldCBwb3MxID0gZ2V0Q29vcmRpbmF0ZXModGFyZ2V0KVswXTtcbiAgICAgICAgbGV0IHBvczIgPSBnZXRDb29yZGluYXRlcyh0YXJnZXQpWzFdO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICAhZ2FtZS5jb21wdXRlci5nZXRTaG90Q29vcmRpbmF0ZXMoKS5pbmNsdWRlcyhpbmRleCkgJiZcbiAgICAgICAgICBnYW1lLmdldFdpbm5lcigpID09IFwiXCIgJiZcbiAgICAgICAgICBnYW1lclNoaXBzLmxlbmd0aCA9PSAwXG4gICAgICAgICkge1xuICAgICAgICAgIGdhbWUuc2V0SW5wdXQoW3BvczEsIHBvczJdKTtcbiAgICAgICAgICBnYW1lLmdhbWVMb29wKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgbGV0IGdhbWVyTWlzc2VkUG9zID0gZ2FtZS5nYW1lci5nZXRNaXNzZWRQb3NpdGlvbnMoKTtcbiAgICAgIGxldCBjb21wdXRlck1pc3NlZFBvcyA9IGdhbWUuY29tcHV0ZXIuZ2V0TWlzc2VkUG9zaXRpb25zKCk7XG4gICAgICBsZXQgZ2FtZXJBdHRhY2tlZFBvcyA9IGdhbWUuZ2FtZXIuZ2V0QXR0YWNrZWRQb3NpdGlvbnMoKTtcbiAgICAgIGxldCBjb21wdXRlckF0dGFja2VkUG9zID0gZ2FtZS5jb21wdXRlci5nZXRBdHRhY2tlZFBvc2l0aW9ucygpO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGdhbWVyTWlzc2VkUG9zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHBsYXllckJvYXJkRGl2LmNoaWxkcmVuW2dhbWVyTWlzc2VkUG9zW2ldXS5jbGFzc0xpc3QuYWRkKFwibWlzc2VkXCIpO1xuICAgICAgfVxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb21wdXRlck1pc3NlZFBvcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb21wdXRlckJvYXJkRGl2LmNoaWxkcmVuW2NvbXB1dGVyTWlzc2VkUG9zW2ldXS5jbGFzc0xpc3QuYWRkKFwibWlzc2VkXCIpO1xuICAgICAgfVxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBnYW1lckF0dGFja2VkUG9zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHBsYXllckJvYXJkRGl2LmNoaWxkcmVuW2dhbWVyQXR0YWNrZWRQb3NbaV1dLmNsYXNzTGlzdC5hZGQoXCJhdHRhY2tlZFwiKTtcblxuICAgICAgICBpZiAocGxheWVyQm9hcmREaXYuY2hpbGRyZW5bZ2FtZXJBdHRhY2tlZFBvc1tpXV0uY2hpbGRyZW4ubGVuZ3RoID09IDApIHtcbiAgICAgICAgICBsZXQgc3ZnRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICBzdmdEaXYuY2xhc3NMaXN0LmFkZChcInNoaXAtc3ZnXCIpO1xuICAgICAgICAgIHBsYXllckJvYXJkRGl2LmNoaWxkcmVuW2dhbWVyQXR0YWNrZWRQb3NbaV1dLmFwcGVuZENoaWxkKHN2Z0Rpdik7XG4gICAgICAgICAgc3ZnRGl2LmlubmVySFRNTCA9XG4gICAgICAgICAgICAnPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgdmlld0JveD1cIjAgMCAyNCAyNFwiPjx0aXRsZT5zaGlwLXdoZWVsPC90aXRsZT48cGF0aCBkPVwiTTIsMTFMNC4wNSwxMS4xQzQuMyw4LjgzIDUuNSw2Ljg1IDcuMjUsNS41Nkw2LjEzLDMuODRDNS44NiwzLjM2IDYsMi43NSA2LjUsMi40N0M3LDIuMiA3LjU5LDIuMzYgNy44NywyLjg0TDguOCw0LjY2QzkuNzgsNC4yNCAxMC44Niw0IDEyLDRDMTMuMTQsNCAxNC4yMiw0LjI0IDE1LjIsNC42NkwxNi4xMywyLjg0QzE2LjQxLDIuMzYgMTcsMi4yIDE3LjUsMi40N0MxOCwyLjc1IDE4LjE0LDMuMzYgMTcuODcsMy44NEwxNi43NSw1LjU2QzE4LjUsNi44NSAxOS43LDguODMgMTkuOTUsMTEuMUwyMiwxMUExLDEgMCAwLDEgMjMsMTJBMSwxIDAgMCwxIDIyLDEzTDE5Ljk1LDEyLjlDMTkuNywxNS4xNyAxOC41LDE3LjE1IDE2Ljc1LDE4LjQ0TDE3Ljg3LDIwLjE2QzE4LjE0LDIwLjY0IDE4LDIxLjI1IDE3LjUsMjEuNTNDMTcsMjEuOCAxNi40MSwyMS42NCAxNi4xMywyMS4xNkwxNS4yLDE5LjM0QzE0LjIyLDE5Ljc2IDEzLjE0LDIwIDEyLDIwQzEwLjg2LDIwIDkuNzgsMTkuNzYgOC44LDE5LjM0TDcuODcsMjEuMTZDNy41OSwyMS42NCA3LDIxLjggNi41LDIxLjUzQzYsMjEuMjUgNS44NiwyMC42NCA2LjEzLDIwLjE2TDcuMjUsMTguNDRDNS41LDE3LjE1IDQuMywxNS4xNyA0LjA1LDEyLjlMMiwxM0ExLDEgMCAwLDEgMSwxMkExLDEgMCAwLDEgMiwxMU05LjA3LDExLjM1QzkuMiwxMC43NCA5LjUzLDEwLjIgMTAsOS43OUw4LjM0LDcuMjVDNy4xMSw4LjE5IDYuMjcsOS42IDYuMDUsMTEuMkw5LjA3LDExLjM1TTEyLDlDMTIuMzIsOSAxMi42Miw5LjA1IDEyLjksOS4xNEwxNC4yOCw2LjQ1QzEzLjU4LDYuMTYgMTIuODEsNiAxMiw2QzExLjE5LDYgMTAuNDIsNi4xNiA5LjcyLDYuNDVMMTEuMSw5LjE0QzExLjM4LDkuMDUgMTEuNjgsOSAxMiw5TTE0LjkzLDExLjM1TDE3Ljk1LDExLjJDMTcuNzMsOS42IDE2Ljg5LDguMTkgMTUuNjYsNy4yNUwxNCw5Ljc5QzE0LjQ3LDEwLjIgMTQuOCwxMC43NCAxNC45MywxMS4zNU0xNC45MywxMi42NUMxNC44LDEzLjI2IDE0LjQ3LDEzLjggMTQsMTQuMjFMMTUuNjYsMTYuNzVDMTYuODksMTUuODEgMTcuNzMsMTQuNCAxNy45NSwxMi44TDE0LjkzLDEyLjY1TTEyLDE1QzExLjY4LDE1IDExLjM4LDE0Ljk1IDExLjA5LDE0Ljg2TDkuNzIsMTcuNTVDMTAuNDIsMTcuODQgMTEuMTksMTggMTIsMThDMTIuODEsMTggMTMuNTgsMTcuODQgMTQuMjgsMTcuNTVMMTIuOTEsMTQuODZDMTIuNjIsMTQuOTUgMTIuMzIsMTUgMTIsMTVNOS4wNywxMi42NUw2LjA1LDEyLjhDNi4yNywxNC40IDcuMTEsMTUuODEgOC4zNCwxNi43NUwxMCwxNC4yMUM5LjUzLDEzLjggOS4yLDEzLjI2IDkuMDcsMTIuNjVaXCIgLz48L3N2Zz4nO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbXB1dGVyQXR0YWNrZWRQb3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29tcHV0ZXJCb2FyZERpdi5jaGlsZHJlbltjb21wdXRlckF0dGFja2VkUG9zW2ldXS5jbGFzc0xpc3QuYWRkKFxuICAgICAgICAgIFwiYXR0YWNrZWRcIlxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChcbiAgICAgICAgICBjb21wdXRlckJvYXJkRGl2LmNoaWxkcmVuW2NvbXB1dGVyQXR0YWNrZWRQb3NbaV1dLmNoaWxkcmVuLmxlbmd0aCA9PSAwXG4gICAgICAgICkge1xuICAgICAgICAgIGxldCBzdmdEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgIHN2Z0Rpdi5jbGFzc0xpc3QuYWRkKFwic2hpcC1zdmdcIik7XG4gICAgICAgICAgY29tcHV0ZXJCb2FyZERpdi5jaGlsZHJlbltjb21wdXRlckF0dGFja2VkUG9zW2ldXS5hcHBlbmRDaGlsZChzdmdEaXYpO1xuICAgICAgICAgIHN2Z0Rpdi5pbm5lckhUTUwgPVxuICAgICAgICAgICAgJzxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHZpZXdCb3g9XCIwIDAgMjQgMjRcIj48dGl0bGU+c2hpcC13aGVlbDwvdGl0bGU+PHBhdGggZD1cIk0yLDExTDQuMDUsMTEuMUM0LjMsOC44MyA1LjUsNi44NSA3LjI1LDUuNTZMNi4xMywzLjg0QzUuODYsMy4zNiA2LDIuNzUgNi41LDIuNDdDNywyLjIgNy41OSwyLjM2IDcuODcsMi44NEw4LjgsNC42NkM5Ljc4LDQuMjQgMTAuODYsNCAxMiw0QzEzLjE0LDQgMTQuMjIsNC4yNCAxNS4yLDQuNjZMMTYuMTMsMi44NEMxNi40MSwyLjM2IDE3LDIuMiAxNy41LDIuNDdDMTgsMi43NSAxOC4xNCwzLjM2IDE3Ljg3LDMuODRMMTYuNzUsNS41NkMxOC41LDYuODUgMTkuNyw4LjgzIDE5Ljk1LDExLjFMMjIsMTFBMSwxIDAgMCwxIDIzLDEyQTEsMSAwIDAsMSAyMiwxM0wxOS45NSwxMi45QzE5LjcsMTUuMTcgMTguNSwxNy4xNSAxNi43NSwxOC40NEwxNy44NywyMC4xNkMxOC4xNCwyMC42NCAxOCwyMS4yNSAxNy41LDIxLjUzQzE3LDIxLjggMTYuNDEsMjEuNjQgMTYuMTMsMjEuMTZMMTUuMiwxOS4zNEMxNC4yMiwxOS43NiAxMy4xNCwyMCAxMiwyMEMxMC44NiwyMCA5Ljc4LDE5Ljc2IDguOCwxOS4zNEw3Ljg3LDIxLjE2QzcuNTksMjEuNjQgNywyMS44IDYuNSwyMS41M0M2LDIxLjI1IDUuODYsMjAuNjQgNi4xMywyMC4xNkw3LjI1LDE4LjQ0QzUuNSwxNy4xNSA0LjMsMTUuMTcgNC4wNSwxMi45TDIsMTNBMSwxIDAgMCwxIDEsMTJBMSwxIDAgMCwxIDIsMTFNOS4wNywxMS4zNUM5LjIsMTAuNzQgOS41MywxMC4yIDEwLDkuNzlMOC4zNCw3LjI1QzcuMTEsOC4xOSA2LjI3LDkuNiA2LjA1LDExLjJMOS4wNywxMS4zNU0xMiw5QzEyLjMyLDkgMTIuNjIsOS4wNSAxMi45LDkuMTRMMTQuMjgsNi40NUMxMy41OCw2LjE2IDEyLjgxLDYgMTIsNkMxMS4xOSw2IDEwLjQyLDYuMTYgOS43Miw2LjQ1TDExLjEsOS4xNEMxMS4zOCw5LjA1IDExLjY4LDkgMTIsOU0xNC45MywxMS4zNUwxNy45NSwxMS4yQzE3LjczLDkuNiAxNi44OSw4LjE5IDE1LjY2LDcuMjVMMTQsOS43OUMxNC40NywxMC4yIDE0LjgsMTAuNzQgMTQuOTMsMTEuMzVNMTQuOTMsMTIuNjVDMTQuOCwxMy4yNiAxNC40NywxMy44IDE0LDE0LjIxTDE1LjY2LDE2Ljc1QzE2Ljg5LDE1LjgxIDE3LjczLDE0LjQgMTcuOTUsMTIuOEwxNC45MywxMi42NU0xMiwxNUMxMS42OCwxNSAxMS4zOCwxNC45NSAxMS4wOSwxNC44Nkw5LjcyLDE3LjU1QzEwLjQyLDE3Ljg0IDExLjE5LDE4IDEyLDE4QzEyLjgxLDE4IDEzLjU4LDE3Ljg0IDE0LjI4LDE3LjU1TDEyLjkxLDE0Ljg2QzEyLjYyLDE0Ljk1IDEyLjMyLDE1IDEyLDE1TTkuMDcsMTIuNjVMNi4wNSwxMi44QzYuMjcsMTQuNCA3LjExLDE1LjgxIDguMzQsMTYuNzVMMTAsMTQuMjFDOS41MywxMy44IDkuMiwxMy4yNiA5LjA3LDEyLjY1WlwiIC8+PC9zdmc+JztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9KSgpO1xuXG4gIGZ1bmN0aW9uIHdhaXQobXMpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpKTtcbiAgfVxuXG4gIChmdW5jdGlvbiByZXNldCgpIHtcbiAgICByZXNldEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XG4gICAgfSk7XG4gIH0pKCk7XG5cbiAgcmV0dXJuIHtcbiAgICBjcmVhdGVHYW1lQm9hcmRzLFxuICAgIHdhaXQsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBkb207XG4iLCJpbXBvcnQgZG9tIGZyb20gXCIuL2RvbVwiO1xuaW1wb3J0IHNoaXAgZnJvbSBcIi4vc2hpcFwiO1xuaW1wb3J0IGdhbWVCb2FyZCBmcm9tIFwiLi9nYW1lYm9hcmRcIjtcbmltcG9ydCBwbGF5ZXIgZnJvbSBcIi4vcGxheWVyXCI7XG5pbXBvcnQgZ2FtZSBmcm9tIFwiLi9nYW1lXCI7XG5cbmRvbS5jcmVhdGVHYW1lQm9hcmRzKCk7XG5nYW1lO1xuIl0sIm5hbWVzIjpbImxlbmd0aCIsIm5hbWUiLCJoaXRzIiwic3VuayIsImhpdCIsImdldEhpdHMiLCJpc1N1bmsiLCJzaGlwTmFtZSIsImJvYXJkIiwibWlzc2VkQXR0YWNrIiwiYXR0YWNrZWRQb3NpdGlvbiIsInNoaXBQb3NpdGlvbiIsInNoaXBzIiwiaW5kZXhGaW5kZXIiLCJwb3MxIiwicG9zMiIsImNoZWNrVmFsaWRpdHkiLCJzaGlwIiwiZGlyZWN0aW9uIiwiaW5kZXgiLCJpIiwiaW5jbHVkZXMiLCJjcmVhdGVCb2FyZCIsImoiLCJuZXdDb29yZGluYXRlcyIsImNvb3JkaW5hdGVzIiwiY3JlYXRlQ29vcmRpbmF0ZSIsInB1c2giLCJnZXRCb2FyZCIsInBsYWNlU2hpcCIsInJlY2VpdmVBdHRhY2siLCJmaW5kU2hpcCIsImlzQWxsU3VuayIsImdldE1pc3NlZFBvc2l0aW9ucyIsImdldEF0dGFja2VkUG9zaXRpb25zIiwiZ2V0U2hpcHNQb3NpdGlvbnMiLCJyYW5kb21Db29yZGluYXRlcyIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInJhbmRvbUF0dGFjayIsImFzeW5jIiwicGxheWVyIiwiZ2V0U2hvdENvb3JkaW5hdGVzIiwicmFuZG9tUGxhY2VtZW50IiwiZ2V0U2hpcHMiLCJnYW1lciIsImNvbXB1dGVyIiwiZ2FtZXJCb2FyZCIsImNvbXB1dGVyQm9hcmQiLCJnYW1lclNoaXBzIiwiY29tcHV0ZXJTaGlwcyIsInR1cm4iLCJ3aW5uZXIiLCJpbnB1dCIsInNldElucHV0IiwiZ2FtZUxvb3AiLCJjb25zb2xlIiwibG9nIiwiZ2V0VHVybiIsImdldFdpbm5lciIsImdldEdhbWVyQm9hcmQiLCJnZXRDb21wdXRlckJvYXJkIiwiZ2V0R2FtZXJTaGlwcyIsImdldENvbXB1dGVyU2hpcHMiLCJkaXNwbGF5IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwicGxheWVyQm9hcmREaXYiLCJjb21wdXRlckJvYXJkRGl2IiwiZGlyZWN0aW9uQnV0dG9uIiwicmVzZXRCdXR0b24iLCJnZXRDb29yZGluYXRlcyIsInRhcmdldCIsImNsYXNzTGlzdCIsInNwbGl0IiwicGFyc2VJbnQiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwidGV4dENvbnRlbnQiLCJjdXJyZW50U2hpcCIsImdyaWQiLCJjb250YWlucyIsInZhbHVlIiwic2hpZnQiLCJzaGlwUG9zaXRpb25zIiwiY2hpbGRyZW4iLCJhZGQiLCJjZWxsIiwicmVtb3ZlIiwiZ2FtZXJNaXNzZWRQb3MiLCJjb21wdXRlck1pc3NlZFBvcyIsImdhbWVyQXR0YWNrZWRQb3MiLCJjb21wdXRlckF0dGFja2VkUG9zIiwic3ZnRGl2IiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZENoaWxkIiwiaW5uZXJIVE1MIiwibG9jYXRpb24iLCJyZWxvYWQiLCJjcmVhdGVHYW1lQm9hcmRzIiwid2FpdCIsIm1zIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0Il0sInNvdXJjZVJvb3QiOiIifQ==