(()=>{"use strict";const e=function(e,t){let n=0,i=!1;return{hit:function(){return n+=1,n},getHits:function(){return n},isSunk:function(){return n==e&&(i=!0),i},length:e,shipName:t}},t=function(){let t=function(){let e=[],t=[],n=[],i=[],r=[];function o(e,t){return 10*e+t}function s(e,t,n,r){let s=o(e,t);if("Horizontal"==r)for(let e=0;e<n.length;e++)if(i.includes(s+e))return!1;if("Vertical"==r)for(let e=0;e<n.length;e++)if(i.includes(s+10*e))return!1;return!("Horizontal"==r&&t+n.length>10||"Vertical"==r&&e+n.length>10)}return{createBoard:function(){for(let t=0;t<10;t++)for(let n=0;n<10;n++){let i={coordinates:void 0,name:void 0};i.coordinates=[t,n],i.name=null,e.push(i)}return e},getBoard:function(){return e},checkValidity:s,placeShip:function(t,n,a,l){if("Horizontal"==l&&s(t,n,a,l)){let r=o(t,n);for(let t=0;t<a.length;t++)e[r+t].name=a.shipName,i.push(r+t)}if("Vertical"==l&&s(t,n,a,l)){let r=o(t,n);for(let t=0;t<a.length;t++)e[r+10*t].name=a.shipName,i.push(r+10*t)}r.push(a)},receiveAttack:function(i,s){let a=o(i,s);null!=e[a].name?n.includes(a)||(n.push(a),function(e){for(let t=0;t<r.length;t++)if(r[t].shipName==e)return r[t]}(e[a].name).hit()):t.includes(a)||t.push(a)},isAllSunk:function(){if(i.length==n.length)return!0},getMissedPositions:function(){return t},getAttackedPositions:function(){return n},getShipsPositions:function(){return i}}}(),n=[e(5,"Carrier"),e(4,"Battleship"),e(3,"Cruiser"),e(3,"Submarine"),e(2,"Destroyer")];function i(){return[Math.floor(10*Math.random()),Math.floor(10*Math.random())]}return{randomAttack:function e(t){let n=i(),r=n[0],o=n[1],s=function(e,t){return 10*e+t}(r,o);t.getShotCoordinates().includes(s)?e(t):t.receiveAttack(r,o)},randomPlacement:function e(n){let r=i(),o=r[0],s=r[1],a="";a=1==Math.floor(2*Math.random())?"Horizontal":"Vertical",t.checkValidity(o,s,n,a)?t.placeShip(o,s,n,a):e(n)},getBoard:function(){return t},getShips:function(){return n},getShotCoordinates:function(){return[...t.getAttackedPositions(),...t.getMissedPositions()]},createBoard:t.createBoard,getBoard:t.getBoard,placeShip:t.placeShip,checkValidity:t.checkValidity,receiveAttack:t.receiveAttack,isAllSunk:t.isAllSunk,getMissedPositions:t.getMissedPositions,getAttackedPositions:t.getAttackedPositions,getShipsPositions:t.getShipsPositions}},n=function(){let e=t(),n=t();e.createBoard(),n.createBoard();let i=e.getBoard(),r=n.getBoard(),o=e.getShips(),s=n.getShips(),a="Gamer",l="",c=[];return{gamer:e,computer:n,setInput:function(e){c=e},gameLoop:function(){"Gamer"==a&&(n.receiveAttack(c[0],c[1]),n.isAllSunk()?l="Gamer":(a="Computer",c=[])),"Computer"==a&&(n.randomAttack(e),e.isAllSunk()?l="Computer":a="Gamer"),console.log(l)},getTurn:function(){return a},getWinner:function(){return l},getGamerBoard:function(){return i},getComputerBoard:function(){return r},getGamerShips:function(){return o},getComputerShips:function(){return s}}}(),i=function(){const e=document.querySelector(".display"),t=document.querySelector(".player-board"),r=document.querySelector(".computer-board"),o=document.querySelector(".direction"),s=document.querySelector(".reset");let a=n.getGamerBoard(),l=n.getComputerBoard(),c=[...n.getGamerShips()],d=[...n.getComputerShips()];function u(e){let t=e.classList[1].split(",");return[parseInt(t[0]),parseInt(t[1])]}return window.addEventListener("load",(()=>{e.textContent="Welcome to Battleship. Place your Carrier"})),window.addEventListener("click",(()=>{switch(c.length){case 4:e.textContent="Place your Battleship";break;case 3:e.textContent="Place your Cruiser";break;case 2:e.textContent="Place your Submarine";break;case 1:e.textContent="Place your Destroyer";break;case 0:""==n.getWinner()?e.textContent=`${n.getTurn()}'s Turn`:e.textContent=`${n.getWinner()} Won`}})),function(){let e,i,r=c[0];t.addEventListener("click",(s=>{if(s.target.classList.contains("player-board")){let l=s.target;if(e=u(l)[0],i=u(l)[1],c.length>0&&n.gamer.checkValidity(e,i,r,o.value)){n.gamer.placeShip(e,i,r,o.value),c.shift(),r=c[0];let s=n.gamer.getShipsPositions();for(let e=0;e<s.length;e++)t.children[s[e]].classList.add("player-ship");console.log(a)}}})),t.addEventListener("mouseover",(t=>{if(t.target.classList.contains("grid")){let s=t.target;e=u(s)[0],i=u(s)[1],c.length>0&&n.gamer.checkValidity(e,i,r,o.value)?s.classList.add("green"):c.length>0&&s.classList.add("red")}})),t.addEventListener("mouseout",(e=>{if(e.target.classList.contains("grid")){(t=e.target).classList.remove("green"),t.classList.remove("red")}var t}))}(),o.addEventListener("click",(()=>{"Horizontal"==o.value?(o.value="Vertical",o.textContent="Set Horizontal"):(o.value="Horizontal",o.textContent="Set Vertical")})),function(){let e=d[0];window.addEventListener("click",(()=>{for(;d.length>0;)n.computer.randomPlacement(e),d.shift(),e=d[0];let t=n.computer.getShipsPositions();for(let e=0;e<t.length;e++)r.children[t[e]].classList.add("computer-ship")}))}(),r.addEventListener("click",(e=>{if(0==c.length&&e.target.classList.contains("computer-board")){let t=e.target,i=parseInt(t.classList[0]),r=u(t)[0],o=u(t)[1];n.computer.getShotCoordinates().includes(i)||""!=n.getWinner()||0!=c.length||(n.setInput([r,o]),n.gameLoop())}})),window.addEventListener("click",(()=>{let e=n.gamer.getMissedPositions(),i=n.computer.getMissedPositions(),o=n.gamer.getAttackedPositions(),s=n.computer.getAttackedPositions();for(let n=0;n<e.length;n++)t.children[e[n]].classList.add("missed");for(let e=0;e<i.length;e++)r.children[i[e]].classList.add("missed");for(let e=0;e<o.length;e++)if(t.children[o[e]].classList.add("attacked"),0==t.children[o[e]].children.length){let n=document.createElement("div");n.classList.add("ship-svg"),t.children[o[e]].appendChild(n),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>ship-wheel</title><path d="M2,11L4.05,11.1C4.3,8.83 5.5,6.85 7.25,5.56L6.13,3.84C5.86,3.36 6,2.75 6.5,2.47C7,2.2 7.59,2.36 7.87,2.84L8.8,4.66C9.78,4.24 10.86,4 12,4C13.14,4 14.22,4.24 15.2,4.66L16.13,2.84C16.41,2.36 17,2.2 17.5,2.47C18,2.75 18.14,3.36 17.87,3.84L16.75,5.56C18.5,6.85 19.7,8.83 19.95,11.1L22,11A1,1 0 0,1 23,12A1,1 0 0,1 22,13L19.95,12.9C19.7,15.17 18.5,17.15 16.75,18.44L17.87,20.16C18.14,20.64 18,21.25 17.5,21.53C17,21.8 16.41,21.64 16.13,21.16L15.2,19.34C14.22,19.76 13.14,20 12,20C10.86,20 9.78,19.76 8.8,19.34L7.87,21.16C7.59,21.64 7,21.8 6.5,21.53C6,21.25 5.86,20.64 6.13,20.16L7.25,18.44C5.5,17.15 4.3,15.17 4.05,12.9L2,13A1,1 0 0,1 1,12A1,1 0 0,1 2,11M9.07,11.35C9.2,10.74 9.53,10.2 10,9.79L8.34,7.25C7.11,8.19 6.27,9.6 6.05,11.2L9.07,11.35M12,9C12.32,9 12.62,9.05 12.9,9.14L14.28,6.45C13.58,6.16 12.81,6 12,6C11.19,6 10.42,6.16 9.72,6.45L11.1,9.14C11.38,9.05 11.68,9 12,9M14.93,11.35L17.95,11.2C17.73,9.6 16.89,8.19 15.66,7.25L14,9.79C14.47,10.2 14.8,10.74 14.93,11.35M14.93,12.65C14.8,13.26 14.47,13.8 14,14.21L15.66,16.75C16.89,15.81 17.73,14.4 17.95,12.8L14.93,12.65M12,15C11.68,15 11.38,14.95 11.09,14.86L9.72,17.55C10.42,17.84 11.19,18 12,18C12.81,18 13.58,17.84 14.28,17.55L12.91,14.86C12.62,14.95 12.32,15 12,15M9.07,12.65L6.05,12.8C6.27,14.4 7.11,15.81 8.34,16.75L10,14.21C9.53,13.8 9.2,13.26 9.07,12.65Z" /></svg>'}for(let e=0;e<s.length;e++)if(r.children[s[e]].classList.add("attacked"),0==r.children[s[e]].children.length){let t=document.createElement("div");t.classList.add("ship-svg"),r.children[s[e]].appendChild(t),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>ship-wheel</title><path d="M2,11L4.05,11.1C4.3,8.83 5.5,6.85 7.25,5.56L6.13,3.84C5.86,3.36 6,2.75 6.5,2.47C7,2.2 7.59,2.36 7.87,2.84L8.8,4.66C9.78,4.24 10.86,4 12,4C13.14,4 14.22,4.24 15.2,4.66L16.13,2.84C16.41,2.36 17,2.2 17.5,2.47C18,2.75 18.14,3.36 17.87,3.84L16.75,5.56C18.5,6.85 19.7,8.83 19.95,11.1L22,11A1,1 0 0,1 23,12A1,1 0 0,1 22,13L19.95,12.9C19.7,15.17 18.5,17.15 16.75,18.44L17.87,20.16C18.14,20.64 18,21.25 17.5,21.53C17,21.8 16.41,21.64 16.13,21.16L15.2,19.34C14.22,19.76 13.14,20 12,20C10.86,20 9.78,19.76 8.8,19.34L7.87,21.16C7.59,21.64 7,21.8 6.5,21.53C6,21.25 5.86,20.64 6.13,20.16L7.25,18.44C5.5,17.15 4.3,15.17 4.05,12.9L2,13A1,1 0 0,1 1,12A1,1 0 0,1 2,11M9.07,11.35C9.2,10.74 9.53,10.2 10,9.79L8.34,7.25C7.11,8.19 6.27,9.6 6.05,11.2L9.07,11.35M12,9C12.32,9 12.62,9.05 12.9,9.14L14.28,6.45C13.58,6.16 12.81,6 12,6C11.19,6 10.42,6.16 9.72,6.45L11.1,9.14C11.38,9.05 11.68,9 12,9M14.93,11.35L17.95,11.2C17.73,9.6 16.89,8.19 15.66,7.25L14,9.79C14.47,10.2 14.8,10.74 14.93,11.35M14.93,12.65C14.8,13.26 14.47,13.8 14,14.21L15.66,16.75C16.89,15.81 17.73,14.4 17.95,12.8L14.93,12.65M12,15C11.68,15 11.38,14.95 11.09,14.86L9.72,17.55C10.42,17.84 11.19,18 12,18C12.81,18 13.58,17.84 14.28,17.55L12.91,14.86C12.62,14.95 12.32,15 12,15M9.07,12.65L6.05,12.8C6.27,14.4 7.11,15.81 8.34,16.75L10,14.21C9.53,13.8 9.2,13.26 9.07,12.65Z" /></svg>'}})),s.addEventListener("click",(()=>{for(;t.hasChildNodes();)t.removeChild(t.firstChild);for(;r.hasChildNodes();)r.removeChild(r.firstChild);i.createGameBoards()})),{createGameBoards:function(){for(let e=0;e<a.length;e++){let n=document.createElement("div");n.classList.add(e),n.classList.add(a[e].coordinates),n.classList.add("grid"),n.classList.add("player-board"),t.appendChild(n)}for(let e=0;e<l.length;e++){let t=document.createElement("div");t.classList.add(e),t.classList.add(l[e].coordinates),t.classList.add("grid"),t.classList.add("computer-board"),r.appendChild(t)}}}}();i.createGameBoards()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LFVBQVVhLElBQUl4QyxFQUFXM0IsR0FBR0ssYUFDakN3RCxFQUFLUCxVQUFVYSxJQUFJLFFBQ25CTixFQUFLUCxVQUFVYSxJQUFJLGdCQUNuQm5CLEVBQWU0QixZQUFZZixFQUM3QixDQUNBLElBQUssSUFBSTdELEVBQUksRUFBR0EsRUFBSTRCLEVBQWNoRCxPQUFRb0IsSUFBSyxDQUM3QyxJQUFJNkQsRUFBT2YsU0FBUzZCLGNBQWMsT0FDbENkLEVBQUtQLFVBQVVhLElBQUluRSxHQUNuQjZELEVBQUtQLFVBQVVhLElBQUl2QyxFQUFjNUIsR0FBR0ssYUFDcEN3RCxFQUFLUCxVQUFVYSxJQUFJLFFBQ25CTixFQUFLUCxVQUFVYSxJQUFJLGtCQUNuQmxCLEVBQWlCMkIsWUFBWWYsRUFDL0IsQ0FDRixFQThORCxDQTNQVyxHQTZQWixFQzVQSW9CLGtCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9zaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvcGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZWJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2RvbS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHNoaXAgPSBmdW5jdGlvbiAobGVuZ3RoLCBuYW1lKSB7XG4gIGxldCBoaXRzID0gMDtcbiAgbGV0IHN1bmsgPSBmYWxzZTtcbiAgbGV0IHNoaXBOYW1lID0gbmFtZTtcblxuICBmdW5jdGlvbiBoaXQoKSB7XG4gICAgaGl0cyArPSAxO1xuICAgIHJldHVybiBoaXRzO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNTdW5rKCkge1xuICAgIGlmIChoaXRzID09IGxlbmd0aCkge1xuICAgICAgc3VuayA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiBzdW5rO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0SGl0cygpIHtcbiAgICByZXR1cm4gaGl0cztcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgaGl0LFxuICAgIGdldEhpdHMsXG4gICAgaXNTdW5rLFxuICAgIGxlbmd0aCxcbiAgICBzaGlwTmFtZSxcbiAgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHNoaXA7XG4iLCJpbXBvcnQgc2hpcCBmcm9tIFwiLi9zaGlwXCI7XG5pbXBvcnQgZ2FtZUJvYXJkIGZyb20gXCIuL2dhbWVib2FyZFwiO1xuXG5jb25zdCBwbGF5ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGxldCBib2FyZCA9IGdhbWVCb2FyZCgpO1xuICBsZXQgY2FycmllciA9IHNoaXAoNSwgXCJDYXJyaWVyXCIpO1xuICBsZXQgYmF0dGxlc2hpcCA9IHNoaXAoNCwgXCJCYXR0bGVzaGlwXCIpO1xuICBsZXQgY3J1aXNlciA9IHNoaXAoMywgXCJDcnVpc2VyXCIpO1xuICBsZXQgc3VibWFyaW5lID0gc2hpcCgzLCBcIlN1Ym1hcmluZVwiKTtcbiAgbGV0IGRlc3Ryb3llciA9IHNoaXAoMiwgXCJEZXN0cm95ZXJcIik7XG4gIGxldCBzaGlwcyA9IFtjYXJyaWVyLCBiYXR0bGVzaGlwLCBjcnVpc2VyLCBzdWJtYXJpbmUsIGRlc3Ryb3llcl07XG5cbiAgZnVuY3Rpb24gaW5kZXhGaW5kZXIocG9zMSwgcG9zMikge1xuICAgIGxldCBpbmRleCA9IHBvczEgKiAxMCArIHBvczI7XG4gICAgcmV0dXJuIGluZGV4O1xuICB9XG5cbiAgZnVuY3Rpb24gcmFuZG9tQ29vcmRpbmF0ZXMoKSB7XG4gICAgbGV0IHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgbGV0IHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG5cbiAgICByZXR1cm4gW3gsIHldO1xuICB9XG5cbiAgZnVuY3Rpb24gcmFuZG9tQXR0YWNrKHBsYXllcikge1xuICAgIGxldCBjb29yZGluYXRlcyA9IHJhbmRvbUNvb3JkaW5hdGVzKCk7XG4gICAgbGV0IHBvczEgPSBjb29yZGluYXRlc1swXTtcbiAgICBsZXQgcG9zMiA9IGNvb3JkaW5hdGVzWzFdO1xuXG4gICAgbGV0IGluZGV4ID0gaW5kZXhGaW5kZXIocG9zMSwgcG9zMik7XG5cbiAgICBpZiAocGxheWVyLmdldFNob3RDb29yZGluYXRlcygpLmluY2x1ZGVzKGluZGV4KSkge1xuICAgICAgcmFuZG9tQXR0YWNrKHBsYXllcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBsYXllci5yZWNlaXZlQXR0YWNrKHBvczEsIHBvczIpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHJhbmRvbVBsYWNlbWVudChzaGlwKSB7XG4gICAgbGV0IGNvb3JkaW5hdGVzID0gcmFuZG9tQ29vcmRpbmF0ZXMoKTtcbiAgICBsZXQgcG9zMSA9IGNvb3JkaW5hdGVzWzBdO1xuICAgIGxldCBwb3MyID0gY29vcmRpbmF0ZXNbMV07XG4gICAgbGV0IGRpcmVjdGlvbiA9IFwiXCI7XG5cbiAgICBsZXQgcmFuZG9tRGlyZWN0aW9uID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMik7XG5cbiAgICBpZiAocmFuZG9tRGlyZWN0aW9uID09IDEpIHtcbiAgICAgIGRpcmVjdGlvbiA9IFwiSG9yaXpvbnRhbFwiO1xuICAgIH0gZWxzZSB7XG4gICAgICBkaXJlY3Rpb24gPSBcIlZlcnRpY2FsXCI7XG4gICAgfVxuXG4gICAgaWYgKGJvYXJkLmNoZWNrVmFsaWRpdHkocG9zMSwgcG9zMiwgc2hpcCwgZGlyZWN0aW9uKSkge1xuICAgICAgYm9hcmQucGxhY2VTaGlwKHBvczEsIHBvczIsIHNoaXAsIGRpcmVjdGlvbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJhbmRvbVBsYWNlbWVudChzaGlwKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBnZXRCb2FyZCgpIHtcbiAgICByZXR1cm4gYm9hcmQ7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRTaGlwcygpIHtcbiAgICByZXR1cm4gc2hpcHM7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRTaG90Q29vcmRpbmF0ZXMoKSB7XG4gICAgbGV0IGF0dGFja2VkID0gYm9hcmQuZ2V0QXR0YWNrZWRQb3NpdGlvbnMoKTtcbiAgICBsZXQgbWlzc2VkID0gYm9hcmQuZ2V0TWlzc2VkUG9zaXRpb25zKCk7XG4gICAgbGV0IHNob3RDb29yZGluYXRlcyA9IFsuLi5hdHRhY2tlZCwgLi4ubWlzc2VkXTtcbiAgICByZXR1cm4gc2hvdENvb3JkaW5hdGVzO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICByYW5kb21BdHRhY2ssXG4gICAgcmFuZG9tUGxhY2VtZW50LFxuICAgIGdldEJvYXJkLFxuICAgIGdldFNoaXBzLFxuICAgIGdldFNob3RDb29yZGluYXRlcyxcbiAgICBjcmVhdGVCb2FyZDogYm9hcmQuY3JlYXRlQm9hcmQsXG4gICAgZ2V0Qm9hcmQ6IGJvYXJkLmdldEJvYXJkLFxuICAgIHBsYWNlU2hpcDogYm9hcmQucGxhY2VTaGlwLFxuICAgIGNoZWNrVmFsaWRpdHk6IGJvYXJkLmNoZWNrVmFsaWRpdHksXG4gICAgcmVjZWl2ZUF0dGFjazogYm9hcmQucmVjZWl2ZUF0dGFjayxcbiAgICBpc0FsbFN1bms6IGJvYXJkLmlzQWxsU3VuayxcbiAgICBnZXRNaXNzZWRQb3NpdGlvbnM6IGJvYXJkLmdldE1pc3NlZFBvc2l0aW9ucyxcbiAgICBnZXRBdHRhY2tlZFBvc2l0aW9uczogYm9hcmQuZ2V0QXR0YWNrZWRQb3NpdGlvbnMsXG4gICAgZ2V0U2hpcHNQb3NpdGlvbnM6IGJvYXJkLmdldFNoaXBzUG9zaXRpb25zLFxuICB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgcGxheWVyO1xuIiwiaW1wb3J0IHNoaXAgZnJvbSBcIi4vc2hpcFwiO1xuY29uc3QgZ2FtZUJvYXJkID0gZnVuY3Rpb24gKCkge1xuICBsZXQgYm9hcmQgPSBbXTtcbiAgbGV0IG1pc3NlZEF0dGFjayA9IFtdO1xuICBsZXQgYXR0YWNrZWRQb3NpdGlvbiA9IFtdO1xuICBsZXQgc2hpcFBvc2l0aW9uID0gW107XG4gIGxldCBzaGlwcyA9IFtdO1xuXG4gIGZ1bmN0aW9uIGNyZWF0ZUNvb3JkaW5hdGUoY29vcmRpbmF0ZXMsIG5hbWUpIHtcbiAgICByZXR1cm4geyBjb29yZGluYXRlcywgbmFtZSB9O1xuICB9XG5cbiAgZnVuY3Rpb24gaW5kZXhGaW5kZXIocG9zMSwgcG9zMikge1xuICAgIGxldCBpbmRleCA9IHBvczEgKiAxMCArIHBvczI7XG4gICAgcmV0dXJuIGluZGV4O1xuICB9XG5cbiAgZnVuY3Rpb24gY3JlYXRlQm9hcmQoKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgbGV0IG5ld0Nvb3JkaW5hdGVzID0gY3JlYXRlQ29vcmRpbmF0ZSgpO1xuICAgICAgICBuZXdDb29yZGluYXRlcy5jb29yZGluYXRlcyA9IFtpLCBqXTtcbiAgICAgICAgbmV3Q29vcmRpbmF0ZXMubmFtZSA9IG51bGw7XG4gICAgICAgIGJvYXJkLnB1c2gobmV3Q29vcmRpbmF0ZXMpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH1cblxuICBmdW5jdGlvbiBjaGVja1ZhbGlkaXR5KHBvczEsIHBvczIsIHNoaXAsIGRpcmVjdGlvbikge1xuICAgIGxldCBpbmRleCA9IGluZGV4RmluZGVyKHBvczEsIHBvczIpO1xuXG4gICAgaWYgKGRpcmVjdGlvbiA9PSBcIkhvcml6b250YWxcIikge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChzaGlwUG9zaXRpb24uaW5jbHVkZXMoaW5kZXggKyBpKSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChkaXJlY3Rpb24gPT0gXCJWZXJ0aWNhbFwiKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKHNoaXBQb3NpdGlvbi5pbmNsdWRlcyhpbmRleCArIGkgKiAxMCkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZGlyZWN0aW9uID09IFwiSG9yaXpvbnRhbFwiICYmIHBvczIgKyBzaGlwLmxlbmd0aCA+IDEwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKGRpcmVjdGlvbiA9PSBcIlZlcnRpY2FsXCIgJiYgcG9zMSArIHNoaXAubGVuZ3RoID4gMTApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBmdW5jdGlvbiBwbGFjZVNoaXAocG9zMSwgcG9zMiwgc2hpcCwgZGlyZWN0aW9uKSB7XG4gICAgaWYgKFxuICAgICAgZGlyZWN0aW9uID09IFwiSG9yaXpvbnRhbFwiICYmXG4gICAgICBjaGVja1ZhbGlkaXR5KHBvczEsIHBvczIsIHNoaXAsIGRpcmVjdGlvbilcbiAgICApIHtcbiAgICAgIGxldCBpbmRleCA9IGluZGV4RmluZGVyKHBvczEsIHBvczIpO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYm9hcmRbaW5kZXggKyBpXS5uYW1lID0gc2hpcC5zaGlwTmFtZTtcbiAgICAgICAgc2hpcFBvc2l0aW9uLnB1c2goaW5kZXggKyBpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZGlyZWN0aW9uID09IFwiVmVydGljYWxcIiAmJiBjaGVja1ZhbGlkaXR5KHBvczEsIHBvczIsIHNoaXAsIGRpcmVjdGlvbikpIHtcbiAgICAgIGxldCBpbmRleCA9IGluZGV4RmluZGVyKHBvczEsIHBvczIpO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYm9hcmRbaW5kZXggKyBpICogMTBdLm5hbWUgPSBzaGlwLnNoaXBOYW1lO1xuICAgICAgICBzaGlwUG9zaXRpb24ucHVzaChpbmRleCArIGkgKiAxMCk7XG4gICAgICB9XG4gICAgfVxuICAgIHNoaXBzLnB1c2goc2hpcCk7XG4gIH1cblxuICBmdW5jdGlvbiByZWNlaXZlQXR0YWNrKHBvczEsIHBvczIpIHtcbiAgICBsZXQgaW5kZXggPSBpbmRleEZpbmRlcihwb3MxLCBwb3MyKTtcblxuICAgIGlmIChib2FyZFtpbmRleF0ubmFtZSAhPSBudWxsKSB7XG4gICAgICBpZiAoIWF0dGFja2VkUG9zaXRpb24uaW5jbHVkZXMoaW5kZXgpKSB7XG4gICAgICAgIGF0dGFja2VkUG9zaXRpb24ucHVzaChpbmRleCk7XG4gICAgICAgIGZpbmRTaGlwKGJvYXJkW2luZGV4XS5uYW1lKS5oaXQoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCFtaXNzZWRBdHRhY2suaW5jbHVkZXMoaW5kZXgpKSB7XG4gICAgICAgIG1pc3NlZEF0dGFjay5wdXNoKGluZGV4KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBmaW5kU2hpcChuYW1lKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKHNoaXBzW2ldLnNoaXBOYW1lID09IG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHNoaXBzW2ldO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGlzQWxsU3VuaygpIHtcbiAgICBpZiAoc2hpcFBvc2l0aW9uLmxlbmd0aCA9PSBhdHRhY2tlZFBvc2l0aW9uLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZ2V0Qm9hcmQoKSB7XG4gICAgcmV0dXJuIGJvYXJkO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0TWlzc2VkUG9zaXRpb25zKCkge1xuICAgIHJldHVybiBtaXNzZWRBdHRhY2s7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRTaGlwc1Bvc2l0aW9ucygpIHtcbiAgICByZXR1cm4gc2hpcFBvc2l0aW9uO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0QXR0YWNrZWRQb3NpdGlvbnMoKSB7XG4gICAgcmV0dXJuIGF0dGFja2VkUG9zaXRpb247XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBjcmVhdGVCb2FyZCxcbiAgICBnZXRCb2FyZCxcbiAgICBjaGVja1ZhbGlkaXR5LFxuICAgIHBsYWNlU2hpcCxcbiAgICByZWNlaXZlQXR0YWNrLFxuICAgIGlzQWxsU3VuayxcbiAgICBnZXRNaXNzZWRQb3NpdGlvbnMsXG4gICAgZ2V0QXR0YWNrZWRQb3NpdGlvbnMsXG4gICAgZ2V0U2hpcHNQb3NpdGlvbnMsXG4gIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBnYW1lQm9hcmQ7XG4iLCJpbXBvcnQgc2hpcCBmcm9tIFwiLi9zaGlwXCI7XG5pbXBvcnQgZ2FtZUJvYXJkIGZyb20gXCIuL2dhbWVib2FyZFwiO1xuaW1wb3J0IHBsYXllciBmcm9tIFwiLi9wbGF5ZXJcIjtcblxuY29uc3QgZ2FtZSA9IChmdW5jdGlvbiAoKSB7XG4gIGxldCBnYW1lciA9IHBsYXllcigpO1xuICBsZXQgY29tcHV0ZXIgPSBwbGF5ZXIoKTtcblxuICBnYW1lci5jcmVhdGVCb2FyZCgpO1xuICBjb21wdXRlci5jcmVhdGVCb2FyZCgpO1xuXG4gIGxldCBnYW1lckJvYXJkID0gZ2FtZXIuZ2V0Qm9hcmQoKTtcbiAgbGV0IGNvbXB1dGVyQm9hcmQgPSBjb21wdXRlci5nZXRCb2FyZCgpO1xuICBsZXQgZ2FtZXJTaGlwcyA9IGdhbWVyLmdldFNoaXBzKCk7XG4gIGxldCBjb21wdXRlclNoaXBzID0gY29tcHV0ZXIuZ2V0U2hpcHMoKTtcblxuICBsZXQgdHVybiA9IFwiR2FtZXJcIjtcbiAgbGV0IHdpbm5lciA9IFwiXCI7XG4gIGxldCBpbnB1dCA9IFtdO1xuXG4gIGZ1bmN0aW9uIGdhbWVMb29wKCkge1xuICAgIGlmICh0dXJuID09IFwiR2FtZXJcIikge1xuICAgICAgY29tcHV0ZXIucmVjZWl2ZUF0dGFjayhpbnB1dFswXSwgaW5wdXRbMV0pO1xuICAgICAgaWYgKGNvbXB1dGVyLmlzQWxsU3VuaygpKSB7XG4gICAgICAgIHdpbm5lciA9IFwiR2FtZXJcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHR1cm4gPSBcIkNvbXB1dGVyXCI7XG4gICAgICAgIGlucHV0ID0gW107XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh0dXJuID09IFwiQ29tcHV0ZXJcIikge1xuICAgICAgY29tcHV0ZXIucmFuZG9tQXR0YWNrKGdhbWVyKTtcbiAgICAgIGlmIChnYW1lci5pc0FsbFN1bmsoKSkge1xuICAgICAgICB3aW5uZXIgPSBcIkNvbXB1dGVyXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0dXJuID0gXCJHYW1lclwiO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zb2xlLmxvZyh3aW5uZXIpO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0SW5wdXQoY29vcmRpbmF0ZXMpIHtcbiAgICBpbnB1dCA9IGNvb3JkaW5hdGVzO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0VHVybigpIHtcbiAgICByZXR1cm4gdHVybjtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFdpbm5lcigpIHtcbiAgICByZXR1cm4gd2lubmVyO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0R2FtZXJCb2FyZCgpIHtcbiAgICByZXR1cm4gZ2FtZXJCb2FyZDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldENvbXB1dGVyQm9hcmQoKSB7XG4gICAgcmV0dXJuIGNvbXB1dGVyQm9hcmQ7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRHYW1lclNoaXBzKCkge1xuICAgIHJldHVybiBnYW1lclNoaXBzO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0Q29tcHV0ZXJTaGlwcygpIHtcbiAgICByZXR1cm4gY29tcHV0ZXJTaGlwcztcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgZ2FtZXIsXG4gICAgY29tcHV0ZXIsXG4gICAgc2V0SW5wdXQsXG4gICAgZ2FtZUxvb3AsXG4gICAgZ2V0VHVybixcbiAgICBnZXRXaW5uZXIsXG4gICAgZ2V0R2FtZXJCb2FyZCxcbiAgICBnZXRDb21wdXRlckJvYXJkLFxuICAgIGdldEdhbWVyU2hpcHMsXG4gICAgZ2V0Q29tcHV0ZXJTaGlwcyxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCBkZWZhdWx0IGdhbWU7XG4iLCJpbXBvcnQgc2hpcCBmcm9tIFwiLi9zaGlwXCI7XG5pbXBvcnQgZ2FtZUJvYXJkIGZyb20gXCIuL2dhbWVib2FyZFwiO1xuaW1wb3J0IHBsYXllciBmcm9tIFwiLi9wbGF5ZXJcIjtcbmltcG9ydCBnYW1lIGZyb20gXCIuL2dhbWVcIjtcblxuY29uc3QgZG9tID0gKGZ1bmN0aW9uICgpIHtcbiAgY29uc3QgZGlzcGxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZGlzcGxheVwiKTtcbiAgY29uc3QgcGxheWVyQm9hcmREaXYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci1ib2FyZFwiKTtcbiAgY29uc3QgY29tcHV0ZXJCb2FyZERpdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY29tcHV0ZXItYm9hcmRcIik7XG4gIGNvbnN0IGRpcmVjdGlvbkJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZGlyZWN0aW9uXCIpO1xuICBjb25zdCByZXNldEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmVzZXRcIik7XG5cbiAgbGV0IGdhbWVyQm9hcmQgPSBnYW1lLmdldEdhbWVyQm9hcmQoKTtcbiAgbGV0IGNvbXB1dGVyQm9hcmQgPSBnYW1lLmdldENvbXB1dGVyQm9hcmQoKTtcbiAgbGV0IGdhbWVyU2hpcHMgPSBbLi4uZ2FtZS5nZXRHYW1lclNoaXBzKCldO1xuICBsZXQgY29tcHV0ZXJTaGlwcyA9IFsuLi5nYW1lLmdldENvbXB1dGVyU2hpcHMoKV07XG5cbiAgZnVuY3Rpb24gY3JlYXRlR2FtZUJvYXJkcygpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGdhbWVyQm9hcmQubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBncmlkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIGdyaWQuY2xhc3NMaXN0LmFkZChpKTtcbiAgICAgIGdyaWQuY2xhc3NMaXN0LmFkZChnYW1lckJvYXJkW2ldLmNvb3JkaW5hdGVzKTtcbiAgICAgIGdyaWQuY2xhc3NMaXN0LmFkZChcImdyaWRcIik7XG4gICAgICBncmlkLmNsYXNzTGlzdC5hZGQoXCJwbGF5ZXItYm9hcmRcIik7XG4gICAgICBwbGF5ZXJCb2FyZERpdi5hcHBlbmRDaGlsZChncmlkKTtcbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb21wdXRlckJvYXJkLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgZ3JpZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBncmlkLmNsYXNzTGlzdC5hZGQoaSk7XG4gICAgICBncmlkLmNsYXNzTGlzdC5hZGQoY29tcHV0ZXJCb2FyZFtpXS5jb29yZGluYXRlcyk7XG4gICAgICBncmlkLmNsYXNzTGlzdC5hZGQoXCJncmlkXCIpO1xuICAgICAgZ3JpZC5jbGFzc0xpc3QuYWRkKFwiY29tcHV0ZXItYm9hcmRcIik7XG4gICAgICBjb21wdXRlckJvYXJkRGl2LmFwcGVuZENoaWxkKGdyaWQpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGdldENvb3JkaW5hdGVzKHRhcmdldCkge1xuICAgIGxldCBjb29yZGluYXRlcyA9IHRhcmdldC5jbGFzc0xpc3RbMV0uc3BsaXQoXCIsXCIpO1xuICAgIGxldCBwb3MxID0gcGFyc2VJbnQoY29vcmRpbmF0ZXNbMF0pO1xuICAgIGxldCBwb3MyID0gcGFyc2VJbnQoY29vcmRpbmF0ZXNbMV0pO1xuXG4gICAgcmV0dXJuIFtwb3MxLCBwb3MyXTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZFZhbGlkaXR5Q29sb3IoY2VsbCkge1xuICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcImdyZWVuXCIpO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVtb3ZlVmFsaWRpdHlDb2xvcihjZWxsKSB7XG4gICAgY2VsbC5jbGFzc0xpc3QucmVtb3ZlKFwiZ3JlZW5cIik7XG4gICAgY2VsbC5jbGFzc0xpc3QucmVtb3ZlKFwicmVkXCIpO1xuICB9XG5cbiAgZnVuY3Rpb24gYWRkTm9uVmFsaWRpdHlDb2xvcihjZWxsKSB7XG4gICAgY2VsbC5jbGFzc0xpc3QuYWRkKFwicmVkXCIpO1xuICB9XG5cbiAgKGZ1bmN0aW9uIGRpc3BsYXlFdmVudHMoKSB7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsICgpID0+IHtcbiAgICAgIGRpc3BsYXkudGV4dENvbnRlbnQgPSBcIldlbGNvbWUgdG8gQmF0dGxlc2hpcC4gUGxhY2UgeW91ciBDYXJyaWVyXCI7XG4gICAgfSk7XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHN3aXRjaCAoZ2FtZXJTaGlwcy5sZW5ndGgpIHtcbiAgICAgICAgY2FzZSA0OlxuICAgICAgICAgIGRpc3BsYXkudGV4dENvbnRlbnQgPSBcIlBsYWNlIHlvdXIgQmF0dGxlc2hpcFwiO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgZGlzcGxheS50ZXh0Q29udGVudCA9IFwiUGxhY2UgeW91ciBDcnVpc2VyXCI7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMjpcbiAgICAgICAgICBkaXNwbGF5LnRleHRDb250ZW50ID0gXCJQbGFjZSB5b3VyIFN1Ym1hcmluZVwiO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgZGlzcGxheS50ZXh0Q29udGVudCA9IFwiUGxhY2UgeW91ciBEZXN0cm95ZXJcIjtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgaWYgKGdhbWUuZ2V0V2lubmVyKCkgPT0gXCJcIikge1xuICAgICAgICAgICAgZGlzcGxheS50ZXh0Q29udGVudCA9IGAke2dhbWUuZ2V0VHVybigpfSdzIFR1cm5gO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkaXNwbGF5LnRleHRDb250ZW50ID0gYCR7Z2FtZS5nZXRXaW5uZXIoKX0gV29uYDtcbiAgICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH0pKCk7XG5cbiAgKGZ1bmN0aW9uIHBsYXllckJvYXJkRXZlbnRzKCkge1xuICAgIGxldCBjdXJyZW50U2hpcCA9IGdhbWVyU2hpcHNbMF07XG4gICAgbGV0IHBvczE7XG4gICAgbGV0IHBvczI7XG5cbiAgICBwbGF5ZXJCb2FyZERpdi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGdyaWQpID0+IHtcbiAgICAgIGlmIChncmlkLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJwbGF5ZXItYm9hcmRcIikpIHtcbiAgICAgICAgbGV0IHRhcmdldCA9IGdyaWQudGFyZ2V0O1xuICAgICAgICBwb3MxID0gZ2V0Q29vcmRpbmF0ZXModGFyZ2V0KVswXTtcbiAgICAgICAgcG9zMiA9IGdldENvb3JkaW5hdGVzKHRhcmdldClbMV07XG4gICAgICAgIGlmIChcbiAgICAgICAgICBnYW1lclNoaXBzLmxlbmd0aCA+IDAgJiZcbiAgICAgICAgICBnYW1lLmdhbWVyLmNoZWNrVmFsaWRpdHkoXG4gICAgICAgICAgICBwb3MxLFxuICAgICAgICAgICAgcG9zMixcbiAgICAgICAgICAgIGN1cnJlbnRTaGlwLFxuICAgICAgICAgICAgZGlyZWN0aW9uQnV0dG9uLnZhbHVlXG4gICAgICAgICAgKVxuICAgICAgICApIHtcbiAgICAgICAgICBnYW1lLmdhbWVyLnBsYWNlU2hpcChwb3MxLCBwb3MyLCBjdXJyZW50U2hpcCwgZGlyZWN0aW9uQnV0dG9uLnZhbHVlKTtcbiAgICAgICAgICBnYW1lclNoaXBzLnNoaWZ0KCk7XG4gICAgICAgICAgY3VycmVudFNoaXAgPSBnYW1lclNoaXBzWzBdO1xuICAgICAgICAgIGxldCBzaGlwUG9zaXRpb25zID0gZ2FtZS5nYW1lci5nZXRTaGlwc1Bvc2l0aW9ucygpO1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcFBvc2l0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgcGxheWVyQm9hcmREaXYuY2hpbGRyZW5bc2hpcFBvc2l0aW9uc1tpXV0uY2xhc3NMaXN0LmFkZChcbiAgICAgICAgICAgICAgXCJwbGF5ZXItc2hpcFwiXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zb2xlLmxvZyhnYW1lckJvYXJkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcGxheWVyQm9hcmREaXYuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCAoZ3JpZCkgPT4ge1xuICAgICAgaWYgKGdyaWQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImdyaWRcIikpIHtcbiAgICAgICAgbGV0IHRhcmdldCA9IGdyaWQudGFyZ2V0O1xuICAgICAgICBwb3MxID0gZ2V0Q29vcmRpbmF0ZXModGFyZ2V0KVswXTtcbiAgICAgICAgcG9zMiA9IGdldENvb3JkaW5hdGVzKHRhcmdldClbMV07XG4gICAgICAgIGlmIChcbiAgICAgICAgICBnYW1lclNoaXBzLmxlbmd0aCA+IDAgJiZcbiAgICAgICAgICBnYW1lLmdhbWVyLmNoZWNrVmFsaWRpdHkoXG4gICAgICAgICAgICBwb3MxLFxuICAgICAgICAgICAgcG9zMixcbiAgICAgICAgICAgIGN1cnJlbnRTaGlwLFxuICAgICAgICAgICAgZGlyZWN0aW9uQnV0dG9uLnZhbHVlXG4gICAgICAgICAgKVxuICAgICAgICApIHtcbiAgICAgICAgICBhZGRWYWxpZGl0eUNvbG9yKHRhcmdldCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZ2FtZXJTaGlwcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgYWRkTm9uVmFsaWRpdHlDb2xvcih0YXJnZXQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBwbGF5ZXJCb2FyZERpdi5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIiwgKGdyaWQpID0+IHtcbiAgICAgIGlmIChncmlkLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJncmlkXCIpKSB7XG4gICAgICAgIGxldCB0YXJnZXQgPSBncmlkLnRhcmdldDtcbiAgICAgICAgcmVtb3ZlVmFsaWRpdHlDb2xvcih0YXJnZXQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KSgpO1xuXG4gIGRpcmVjdGlvbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGlmIChkaXJlY3Rpb25CdXR0b24udmFsdWUgPT0gXCJIb3Jpem9udGFsXCIpIHtcbiAgICAgIGRpcmVjdGlvbkJ1dHRvbi52YWx1ZSA9IFwiVmVydGljYWxcIjtcbiAgICAgIGRpcmVjdGlvbkJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU2V0IEhvcml6b250YWxcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgZGlyZWN0aW9uQnV0dG9uLnZhbHVlID0gXCJIb3Jpem9udGFsXCI7XG4gICAgICBkaXJlY3Rpb25CdXR0b24udGV4dENvbnRlbnQgPSBcIlNldCBWZXJ0aWNhbFwiO1xuICAgIH1cbiAgfSk7XG5cbiAgKGZ1bmN0aW9uIGNvbXB1dGVyQm9hcmRFdmVudHMoKSB7XG4gICAgbGV0IGN1cnJlbnRTaGlwID0gY29tcHV0ZXJTaGlwc1swXTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHdoaWxlIChjb21wdXRlclNoaXBzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZ2FtZS5jb21wdXRlci5yYW5kb21QbGFjZW1lbnQoY3VycmVudFNoaXApO1xuICAgICAgICBjb21wdXRlclNoaXBzLnNoaWZ0KCk7XG4gICAgICAgIGN1cnJlbnRTaGlwID0gY29tcHV0ZXJTaGlwc1swXTtcbiAgICAgIH1cbiAgICAgIGxldCBzaGlwUG9zaXRpb25zID0gZ2FtZS5jb21wdXRlci5nZXRTaGlwc1Bvc2l0aW9ucygpO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwUG9zaXRpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbXB1dGVyQm9hcmREaXYuY2hpbGRyZW5bc2hpcFBvc2l0aW9uc1tpXV0uY2xhc3NMaXN0LmFkZChcbiAgICAgICAgICBcImNvbXB1dGVyLXNoaXBcIlxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0pO1xuICB9KSgpO1xuXG4gIChmdW5jdGlvbiBnYW1lTG9vcEV2ZW50cygpIHtcbiAgICBjb21wdXRlckJvYXJkRGl2LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZ3JpZCkgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBnYW1lclNoaXBzLmxlbmd0aCA9PSAwICYmXG4gICAgICAgIGdyaWQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImNvbXB1dGVyLWJvYXJkXCIpXG4gICAgICApIHtcbiAgICAgICAgbGV0IHRhcmdldCA9IGdyaWQudGFyZ2V0O1xuICAgICAgICBsZXQgaW5kZXggPSBwYXJzZUludCh0YXJnZXQuY2xhc3NMaXN0WzBdKTtcbiAgICAgICAgbGV0IHBvczEgPSBnZXRDb29yZGluYXRlcyh0YXJnZXQpWzBdO1xuICAgICAgICBsZXQgcG9zMiA9IGdldENvb3JkaW5hdGVzKHRhcmdldClbMV07XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgICFnYW1lLmNvbXB1dGVyLmdldFNob3RDb29yZGluYXRlcygpLmluY2x1ZGVzKGluZGV4KSAmJlxuICAgICAgICAgIGdhbWUuZ2V0V2lubmVyKCkgPT0gXCJcIiAmJlxuICAgICAgICAgIGdhbWVyU2hpcHMubGVuZ3RoID09IDBcbiAgICAgICAgKSB7XG4gICAgICAgICAgZ2FtZS5zZXRJbnB1dChbcG9zMSwgcG9zMl0pO1xuICAgICAgICAgIGdhbWUuZ2FtZUxvb3AoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBsZXQgZ2FtZXJNaXNzZWRQb3MgPSBnYW1lLmdhbWVyLmdldE1pc3NlZFBvc2l0aW9ucygpO1xuICAgICAgbGV0IGNvbXB1dGVyTWlzc2VkUG9zID0gZ2FtZS5jb21wdXRlci5nZXRNaXNzZWRQb3NpdGlvbnMoKTtcbiAgICAgIGxldCBnYW1lckF0dGFja2VkUG9zID0gZ2FtZS5nYW1lci5nZXRBdHRhY2tlZFBvc2l0aW9ucygpO1xuICAgICAgbGV0IGNvbXB1dGVyQXR0YWNrZWRQb3MgPSBnYW1lLmNvbXB1dGVyLmdldEF0dGFja2VkUG9zaXRpb25zKCk7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ2FtZXJNaXNzZWRQb3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgcGxheWVyQm9hcmREaXYuY2hpbGRyZW5bZ2FtZXJNaXNzZWRQb3NbaV1dLmNsYXNzTGlzdC5hZGQoXCJtaXNzZWRcIik7XG4gICAgICB9XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbXB1dGVyTWlzc2VkUG9zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbXB1dGVyQm9hcmREaXYuY2hpbGRyZW5bY29tcHV0ZXJNaXNzZWRQb3NbaV1dLmNsYXNzTGlzdC5hZGQoXCJtaXNzZWRcIik7XG4gICAgICB9XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGdhbWVyQXR0YWNrZWRQb3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgcGxheWVyQm9hcmREaXYuY2hpbGRyZW5bZ2FtZXJBdHRhY2tlZFBvc1tpXV0uY2xhc3NMaXN0LmFkZChcImF0dGFja2VkXCIpO1xuXG4gICAgICAgIGlmIChwbGF5ZXJCb2FyZERpdi5jaGlsZHJlbltnYW1lckF0dGFja2VkUG9zW2ldXS5jaGlsZHJlbi5sZW5ndGggPT0gMCkge1xuICAgICAgICAgIGxldCBzdmdEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgIHN2Z0Rpdi5jbGFzc0xpc3QuYWRkKFwic2hpcC1zdmdcIik7XG4gICAgICAgICAgcGxheWVyQm9hcmREaXYuY2hpbGRyZW5bZ2FtZXJBdHRhY2tlZFBvc1tpXV0uYXBwZW5kQ2hpbGQoc3ZnRGl2KTtcbiAgICAgICAgICBzdmdEaXYuaW5uZXJIVE1MID1cbiAgICAgICAgICAgICc8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCI+PHRpdGxlPnNoaXAtd2hlZWw8L3RpdGxlPjxwYXRoIGQ9XCJNMiwxMUw0LjA1LDExLjFDNC4zLDguODMgNS41LDYuODUgNy4yNSw1LjU2TDYuMTMsMy44NEM1Ljg2LDMuMzYgNiwyLjc1IDYuNSwyLjQ3QzcsMi4yIDcuNTksMi4zNiA3Ljg3LDIuODRMOC44LDQuNjZDOS43OCw0LjI0IDEwLjg2LDQgMTIsNEMxMy4xNCw0IDE0LjIyLDQuMjQgMTUuMiw0LjY2TDE2LjEzLDIuODRDMTYuNDEsMi4zNiAxNywyLjIgMTcuNSwyLjQ3QzE4LDIuNzUgMTguMTQsMy4zNiAxNy44NywzLjg0TDE2Ljc1LDUuNTZDMTguNSw2Ljg1IDE5LjcsOC44MyAxOS45NSwxMS4xTDIyLDExQTEsMSAwIDAsMSAyMywxMkExLDEgMCAwLDEgMjIsMTNMMTkuOTUsMTIuOUMxOS43LDE1LjE3IDE4LjUsMTcuMTUgMTYuNzUsMTguNDRMMTcuODcsMjAuMTZDMTguMTQsMjAuNjQgMTgsMjEuMjUgMTcuNSwyMS41M0MxNywyMS44IDE2LjQxLDIxLjY0IDE2LjEzLDIxLjE2TDE1LjIsMTkuMzRDMTQuMjIsMTkuNzYgMTMuMTQsMjAgMTIsMjBDMTAuODYsMjAgOS43OCwxOS43NiA4LjgsMTkuMzRMNy44NywyMS4xNkM3LjU5LDIxLjY0IDcsMjEuOCA2LjUsMjEuNTNDNiwyMS4yNSA1Ljg2LDIwLjY0IDYuMTMsMjAuMTZMNy4yNSwxOC40NEM1LjUsMTcuMTUgNC4zLDE1LjE3IDQuMDUsMTIuOUwyLDEzQTEsMSAwIDAsMSAxLDEyQTEsMSAwIDAsMSAyLDExTTkuMDcsMTEuMzVDOS4yLDEwLjc0IDkuNTMsMTAuMiAxMCw5Ljc5TDguMzQsNy4yNUM3LjExLDguMTkgNi4yNyw5LjYgNi4wNSwxMS4yTDkuMDcsMTEuMzVNMTIsOUMxMi4zMiw5IDEyLjYyLDkuMDUgMTIuOSw5LjE0TDE0LjI4LDYuNDVDMTMuNTgsNi4xNiAxMi44MSw2IDEyLDZDMTEuMTksNiAxMC40Miw2LjE2IDkuNzIsNi40NUwxMS4xLDkuMTRDMTEuMzgsOS4wNSAxMS42OCw5IDEyLDlNMTQuOTMsMTEuMzVMMTcuOTUsMTEuMkMxNy43Myw5LjYgMTYuODksOC4xOSAxNS42Niw3LjI1TDE0LDkuNzlDMTQuNDcsMTAuMiAxNC44LDEwLjc0IDE0LjkzLDExLjM1TTE0LjkzLDEyLjY1QzE0LjgsMTMuMjYgMTQuNDcsMTMuOCAxNCwxNC4yMUwxNS42NiwxNi43NUMxNi44OSwxNS44MSAxNy43MywxNC40IDE3Ljk1LDEyLjhMMTQuOTMsMTIuNjVNMTIsMTVDMTEuNjgsMTUgMTEuMzgsMTQuOTUgMTEuMDksMTQuODZMOS43MiwxNy41NUMxMC40MiwxNy44NCAxMS4xOSwxOCAxMiwxOEMxMi44MSwxOCAxMy41OCwxNy44NCAxNC4yOCwxNy41NUwxMi45MSwxNC44NkMxMi42MiwxNC45NSAxMi4zMiwxNSAxMiwxNU05LjA3LDEyLjY1TDYuMDUsMTIuOEM2LjI3LDE0LjQgNy4xMSwxNS44MSA4LjM0LDE2Ljc1TDEwLDE0LjIxQzkuNTMsMTMuOCA5LjIsMTMuMjYgOS4wNywxMi42NVpcIiAvPjwvc3ZnPic7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29tcHV0ZXJBdHRhY2tlZFBvcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb21wdXRlckJvYXJkRGl2LmNoaWxkcmVuW2NvbXB1dGVyQXR0YWNrZWRQb3NbaV1dLmNsYXNzTGlzdC5hZGQoXG4gICAgICAgICAgXCJhdHRhY2tlZFwiXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIGNvbXB1dGVyQm9hcmREaXYuY2hpbGRyZW5bY29tcHV0ZXJBdHRhY2tlZFBvc1tpXV0uY2hpbGRyZW4ubGVuZ3RoID09IDBcbiAgICAgICAgKSB7XG4gICAgICAgICAgbGV0IHN2Z0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgc3ZnRGl2LmNsYXNzTGlzdC5hZGQoXCJzaGlwLXN2Z1wiKTtcbiAgICAgICAgICBjb21wdXRlckJvYXJkRGl2LmNoaWxkcmVuW2NvbXB1dGVyQXR0YWNrZWRQb3NbaV1dLmFwcGVuZENoaWxkKHN2Z0Rpdik7XG4gICAgICAgICAgc3ZnRGl2LmlubmVySFRNTCA9XG4gICAgICAgICAgICAnPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgdmlld0JveD1cIjAgMCAyNCAyNFwiPjx0aXRsZT5zaGlwLXdoZWVsPC90aXRsZT48cGF0aCBkPVwiTTIsMTFMNC4wNSwxMS4xQzQuMyw4LjgzIDUuNSw2Ljg1IDcuMjUsNS41Nkw2LjEzLDMuODRDNS44NiwzLjM2IDYsMi43NSA2LjUsMi40N0M3LDIuMiA3LjU5LDIuMzYgNy44NywyLjg0TDguOCw0LjY2QzkuNzgsNC4yNCAxMC44Niw0IDEyLDRDMTMuMTQsNCAxNC4yMiw0LjI0IDE1LjIsNC42NkwxNi4xMywyLjg0QzE2LjQxLDIuMzYgMTcsMi4yIDE3LjUsMi40N0MxOCwyLjc1IDE4LjE0LDMuMzYgMTcuODcsMy44NEwxNi43NSw1LjU2QzE4LjUsNi44NSAxOS43LDguODMgMTkuOTUsMTEuMUwyMiwxMUExLDEgMCAwLDEgMjMsMTJBMSwxIDAgMCwxIDIyLDEzTDE5Ljk1LDEyLjlDMTkuNywxNS4xNyAxOC41LDE3LjE1IDE2Ljc1LDE4LjQ0TDE3Ljg3LDIwLjE2QzE4LjE0LDIwLjY0IDE4LDIxLjI1IDE3LjUsMjEuNTNDMTcsMjEuOCAxNi40MSwyMS42NCAxNi4xMywyMS4xNkwxNS4yLDE5LjM0QzE0LjIyLDE5Ljc2IDEzLjE0LDIwIDEyLDIwQzEwLjg2LDIwIDkuNzgsMTkuNzYgOC44LDE5LjM0TDcuODcsMjEuMTZDNy41OSwyMS42NCA3LDIxLjggNi41LDIxLjUzQzYsMjEuMjUgNS44NiwyMC42NCA2LjEzLDIwLjE2TDcuMjUsMTguNDRDNS41LDE3LjE1IDQuMywxNS4xNyA0LjA1LDEyLjlMMiwxM0ExLDEgMCAwLDEgMSwxMkExLDEgMCAwLDEgMiwxMU05LjA3LDExLjM1QzkuMiwxMC43NCA5LjUzLDEwLjIgMTAsOS43OUw4LjM0LDcuMjVDNy4xMSw4LjE5IDYuMjcsOS42IDYuMDUsMTEuMkw5LjA3LDExLjM1TTEyLDlDMTIuMzIsOSAxMi42Miw5LjA1IDEyLjksOS4xNEwxNC4yOCw2LjQ1QzEzLjU4LDYuMTYgMTIuODEsNiAxMiw2QzExLjE5LDYgMTAuNDIsNi4xNiA5LjcyLDYuNDVMMTEuMSw5LjE0QzExLjM4LDkuMDUgMTEuNjgsOSAxMiw5TTE0LjkzLDExLjM1TDE3Ljk1LDExLjJDMTcuNzMsOS42IDE2Ljg5LDguMTkgMTUuNjYsNy4yNUwxNCw5Ljc5QzE0LjQ3LDEwLjIgMTQuOCwxMC43NCAxNC45MywxMS4zNU0xNC45MywxMi42NUMxNC44LDEzLjI2IDE0LjQ3LDEzLjggMTQsMTQuMjFMMTUuNjYsMTYuNzVDMTYuODksMTUuODEgMTcuNzMsMTQuNCAxNy45NSwxMi44TDE0LjkzLDEyLjY1TTEyLDE1QzExLjY4LDE1IDExLjM4LDE0Ljk1IDExLjA5LDE0Ljg2TDkuNzIsMTcuNTVDMTAuNDIsMTcuODQgMTEuMTksMTggMTIsMThDMTIuODEsMTggMTMuNTgsMTcuODQgMTQuMjgsMTcuNTVMMTIuOTEsMTQuODZDMTIuNjIsMTQuOTUgMTIuMzIsMTUgMTIsMTVNOS4wNywxMi42NUw2LjA1LDEyLjhDNi4yNywxNC40IDcuMTEsMTUuODEgOC4zNCwxNi43NUwxMCwxNC4yMUM5LjUzLDEzLjggOS4yLDEzLjI2IDkuMDcsMTIuNjVaXCIgLz48L3N2Zz4nO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH0pKCk7XG5cbiAgKGZ1bmN0aW9uIHJlc2V0KCkge1xuICAgIHJlc2V0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBkb207XG4gICAgICBnYW1lO1xuICAgICAgd2hpbGUgKHBsYXllckJvYXJkRGl2Lmhhc0NoaWxkTm9kZXMoKSkge1xuICAgICAgICBwbGF5ZXJCb2FyZERpdi5yZW1vdmVDaGlsZChwbGF5ZXJCb2FyZERpdi5maXJzdENoaWxkKTtcbiAgICAgIH1cbiAgICAgIHdoaWxlIChjb21wdXRlckJvYXJkRGl2Lmhhc0NoaWxkTm9kZXMoKSkge1xuICAgICAgICBjb21wdXRlckJvYXJkRGl2LnJlbW92ZUNoaWxkKGNvbXB1dGVyQm9hcmREaXYuZmlyc3RDaGlsZCk7XG4gICAgICB9XG4gICAgICBkb20uY3JlYXRlR2FtZUJvYXJkcygpO1xuICAgIH0pO1xuICB9KSgpO1xuXG4gIHJldHVybiB7XG4gICAgY3JlYXRlR2FtZUJvYXJkcyxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCBkZWZhdWx0IGRvbTtcbiIsImltcG9ydCBkb20gZnJvbSBcIi4vZG9tXCI7XG5pbXBvcnQgc2hpcCBmcm9tIFwiLi9zaGlwXCI7XG5pbXBvcnQgZ2FtZUJvYXJkIGZyb20gXCIuL2dhbWVib2FyZFwiO1xuaW1wb3J0IHBsYXllciBmcm9tIFwiLi9wbGF5ZXJcIjtcbmltcG9ydCBnYW1lIGZyb20gXCIuL2dhbWVcIjtcblxuZG9tLmNyZWF0ZUdhbWVCb2FyZHMoKTtcbmdhbWU7XG4iXSwibmFtZXMiOlsibGVuZ3RoIiwibmFtZSIsImhpdHMiLCJzdW5rIiwiaGl0IiwiZ2V0SGl0cyIsImlzU3VuayIsInNoaXBOYW1lIiwiYm9hcmQiLCJtaXNzZWRBdHRhY2siLCJhdHRhY2tlZFBvc2l0aW9uIiwic2hpcFBvc2l0aW9uIiwic2hpcHMiLCJpbmRleEZpbmRlciIsInBvczEiLCJwb3MyIiwiY2hlY2tWYWxpZGl0eSIsInNoaXAiLCJkaXJlY3Rpb24iLCJpbmRleCIsImkiLCJpbmNsdWRlcyIsImNyZWF0ZUJvYXJkIiwiaiIsIm5ld0Nvb3JkaW5hdGVzIiwiY29vcmRpbmF0ZXMiLCJjcmVhdGVDb29yZGluYXRlIiwicHVzaCIsImdldEJvYXJkIiwicGxhY2VTaGlwIiwicmVjZWl2ZUF0dGFjayIsImZpbmRTaGlwIiwiaXNBbGxTdW5rIiwiZ2V0TWlzc2VkUG9zaXRpb25zIiwiZ2V0QXR0YWNrZWRQb3NpdGlvbnMiLCJnZXRTaGlwc1Bvc2l0aW9ucyIsInJhbmRvbUNvb3JkaW5hdGVzIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwicmFuZG9tQXR0YWNrIiwicGxheWVyIiwiZ2V0U2hvdENvb3JkaW5hdGVzIiwicmFuZG9tUGxhY2VtZW50IiwiZ2V0U2hpcHMiLCJnYW1lciIsImNvbXB1dGVyIiwiZ2FtZXJCb2FyZCIsImNvbXB1dGVyQm9hcmQiLCJnYW1lclNoaXBzIiwiY29tcHV0ZXJTaGlwcyIsInR1cm4iLCJ3aW5uZXIiLCJpbnB1dCIsInNldElucHV0IiwiZ2FtZUxvb3AiLCJjb25zb2xlIiwibG9nIiwiZ2V0VHVybiIsImdldFdpbm5lciIsImdldEdhbWVyQm9hcmQiLCJnZXRDb21wdXRlckJvYXJkIiwiZ2V0R2FtZXJTaGlwcyIsImdldENvbXB1dGVyU2hpcHMiLCJkb20iLCJkaXNwbGF5IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwicGxheWVyQm9hcmREaXYiLCJjb21wdXRlckJvYXJkRGl2IiwiZGlyZWN0aW9uQnV0dG9uIiwicmVzZXRCdXR0b24iLCJnZXRDb29yZGluYXRlcyIsInRhcmdldCIsImNsYXNzTGlzdCIsInNwbGl0IiwicGFyc2VJbnQiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwidGV4dENvbnRlbnQiLCJjdXJyZW50U2hpcCIsImdyaWQiLCJjb250YWlucyIsInZhbHVlIiwic2hpZnQiLCJzaGlwUG9zaXRpb25zIiwiY2hpbGRyZW4iLCJhZGQiLCJjZWxsIiwicmVtb3ZlIiwiZ2FtZXJNaXNzZWRQb3MiLCJjb21wdXRlck1pc3NlZFBvcyIsImdhbWVyQXR0YWNrZWRQb3MiLCJjb21wdXRlckF0dGFja2VkUG9zIiwic3ZnRGl2IiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZENoaWxkIiwiaW5uZXJIVE1MIiwiaGFzQ2hpbGROb2RlcyIsInJlbW92ZUNoaWxkIiwiZmlyc3RDaGlsZCIsImNyZWF0ZUdhbWVCb2FyZHMiXSwic291cmNlUm9vdCI6IiJ9